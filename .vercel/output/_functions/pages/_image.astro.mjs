import{g as r,i as e,a as t,l as n}from"../chunks/_astro_assets_Cenp1MQy.mjs";import{i as s}from"../chunks/path_BpDFqaMc.mjs";export{renderers}from"../renderers.mjs";const o=(r,e=!1)=>(e?'W/"':'"')+(r=>{const e=r.length;let t=0,n=0,s=8997,o=0,a=33826,i=0,c=40164,u=0,f=52210;for(;t<e;)s^=r.charCodeAt(t++),n=435*s,o=435*a,i=435*c,u=435*f,i+=s<<8,u+=a<<8,o+=n>>>16,s=65535&n,i+=o>>>16,a=65535&o,f=u+(i>>>16)&65535,c=65535&i;return 281474976710656*(15&f)+4294967296*c+65536*a+(s^f>>4)})(r).toString(36)+r.length.toString(36)+'"';const a=Object.freeze(Object.defineProperty({__proto__:null,GET:async({request:a})=>{try{const i=await r();if(!("transform"in i))throw new Error("Configured image service is not a local service");const c=new URL(a.url),u=await i.parseURL(c,e);if(!u?.src)throw new Error("Incorrect transform returned by `parseURL`");let f;const w=s(u.src),l=w?new URL(u.src):new URL(u.src,c.origin);if(w&&!1===t(u.src,e))return new Response("Forbidden",{status:403});if(f=await async function(r,e){try{const t=await fetch(r,{headers:e});if(!t.ok)return;return await t.arrayBuffer()}catch{return}}(l,w?new Headers:a.headers),!f)return new Response("Not Found",{status:404});const{data:m,format:d}=await i.transform(new Uint8Array(f),u,e);return new Response(m,{status:200,headers:{"Content-Type":n(d)??`image/${d}`,"Cache-Control":"public, max-age=31536000",ETag:o(m.toString()),Date:(new Date).toUTCString()}})}catch(r){return console.error("Could not process image request:",r),new Response(`Server Error: ${r}`,{status:500})}}},Symbol.toStringTag,{value:"Module"})),i=()=>a;export{i as page};
