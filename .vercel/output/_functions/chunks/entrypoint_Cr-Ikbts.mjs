import{T as e,V as t,W as r,r as n,b as s,X as o,Y as a,A as i,Z as c,$ as u,a0 as l,a1 as d,a2 as h,a3 as f,a4 as p,a5 as m,a6 as g,a7 as y,a8 as v,a9 as w,aa as b,ab as R,ac as x,ad as k,ae as E,D as P,af as A,ag as S,ah as O,ai as L,aj as D,j as T,ak as $,al as I,am as M,an as C,ao as j,ap as _,aq as q,ar as N,as as U,at as F,au as H,av as W,aw as z,ax as K,ay as B,az as V,aA as J,aB as G,aC as X,aD as Y}from"./astro/server_Cr3L-o0H.mjs";import{d as Z,A as Q,a as ee,s as te,b as re,c as ne,g as se,D as oe,e as ae,N as ie,f as ce,h as ue}from"./astro-designed-error-pages_C2pwlEix.mjs";import le from"node:buffer";import de from"node:crypto";import{Http2ServerResponse as he}from"node:http2";import{a as fe,j as pe,b as me,p as ge,t as ye,f as ve,s as we,c as be,h as Re}from"./path_BpDFqaMc.mjs";import{u as xe}from"./parse_Dcu5-KR0.mjs";import ke from"url";import Ee from"node:path";function Pe(e,t){switch(e){case"always":return!0;case"never":return!1;case"ignore":switch(t){case"directory":return!0;case"preserve":case"file":return!1}}}function Ae(e){return"string"==typeof e?e.startsWith("http://")||e.startsWith("https://"):e.destination.startsWith("http://")||e.destination.startsWith("https://")}async function Se(e){const{request:{method:t},routeData:r}=e,{redirect:n,redirectRoute:s}=r,o=s&&"object"==typeof n?n.status:"GET"===t?301:308,a={location:encodeURI(Oe(e))};return n&&Ae(n)?"string"==typeof n?Response.redirect(n,o):Response.redirect(n.destination,o):new Response(null,{status:o,headers:a})}function Oe(e){const{params:t,routeData:{redirect:r,redirectRoute:n}}=e;if(void 0!==n)return n?.generate(t)||n?.pathname||"/";if("string"==typeof r){if(Ae(r))return r;{let e=r;for(const r of Object.keys(t)){const n=t[r];e=e.replace(`[${r}]`,n).replace(`[...${r}]`,n)}return e}}return void 0===r?"/":r.destination}const Le="_server-islands.astro";function De(e){return new Response(null,{status:400,statusText:"Bad request: "+e})}function Te(o){const a=async a=>{const i=a.params;if(!i.name)return new Response(null,{status:400,statusText:"Bad request"});const c=i.name,u=await async function(e){switch(e.method){case"GET":{const t=new URL(e.url).searchParams;if(!t.has("s")||!t.has("e")||!t.has("p"))return De("Missing required query parameters.");const r=t.get("s");try{return{componentExport:t.get("e"),encryptedProps:t.get("p"),slots:JSON.parse(r)}}catch{return De("Invalid slots format.")}}case"POST":try{const t=await e.text();return JSON.parse(t)}catch{return De("Request format is invalid.")}default:return new Response(null,{status:405})}}(a.request);if(u instanceof Response)return u;const l=o.serverIslandMap?.get(c);if(!l)return new Response(null,{status:404,statusText:"Not found"});const d=await o.key,h=u.encryptedProps,f=""===h?"{}":await e(d,h),p=JSON.parse(f);let m=(await l())[u.componentExport];const g={};for(const e in u.slots)g[e]=t(u.slots[e]);if(a.response.headers.set("X-Robots-Tag","noindex"),r(m)){const e=m;m=function(...t){return e.apply(this,t)},Object.assign(m,e),m.propagation="self"}return s`${n(a,"Component",m,p,g)}`};a.isAstroComponentFactory=!0;return{default:a,partial:!0}}function $e(e,t){return t.routes.find((t=>t.pattern.test(e)||t.fallbackRoutes.some((t=>t.pattern.test(e)))))}const Ie=/^\/404\/?$/,Me=/^\/500\/?$/;function Ce(e){return Ie.test(e)}function je(e){return Me.test(e)}function _e(e,t,r,n){if(!e)return(e,t)=>t();const s={...e,trailingSlash:r,base:t,format:n},u=function({trailingSlash:e,format:t,base:r,defaultLocale:n}){return function(s,o){return Pe(e,t)?s.redirect(`${fe(pe(r,n))}`,o):s.redirect(`${pe(r,n)}`,o)}}(s),l=function({base:e,locales:t,fallback:r}){return function(n,s){if("no"===s?.headers.get(a)&&void 0===r)return s;const o=n.url;return o.pathname===e+"/"||o.pathname===e||Ne(o.pathname,t)?void 0:s?(s.headers.set(a,"no"),new Response(s.body,{status:404,headers:s.headers})):new Response(null,{status:404,headers:{[a]:"no"}})}}(s),d=(h=s.locales,function(e){return Ne(e.url.pathname,h)});var h;const f=function({fallback:e,locales:t,defaultLocale:r,strategy:n,base:s,fallbackType:o}){return async function(a,u){if(u.status>=300&&e){const u=e?Object.keys(e):[],l=a.url.pathname.split("/").find((e=>{for(const r of t)if("string"==typeof r){if(r===e)return!0}else if(r.path===e)return!0;return!1}));if(l&&u.includes(l)){const u=function(e,t){for(const r of t)if("string"==typeof r){if(r===e)return r}else for(const t of r.codes)if(t===e)return r.path;throw new i(c)}(e[l],t);let d;return d=u===r&&"pathname-prefix-other-locales"===n?a.url.pathname.includes(`${s}`)?a.url.pathname.replace(`/${l}`,""):a.url.pathname.replace(`/${l}`,"/"):a.url.pathname.replace(`/${l}`,`/${u}`),"rewrite"===o?await a.rewrite(d+a.url.search):a.redirect(d+a.url.search)}}return u}}(s),p=(e,r)=>{const n=e.url;return n.pathname===t+"/"||n.pathname===t?u(e):d(e)?void 0:l(e,r)},m=(t,r)=>{let n=!1;const s=t.url;for(const t of s.pathname.split("/"))if(Ue(t)===Ue(e.defaultLocale)){n=!0;break}if(n){const n=s.pathname.replace(`/${e.defaultLocale}`,"");return r.headers.set("Location",n),l(t)}};return async(r,n)=>{const s=await n(),i=s.headers.get(o);if("no"===s.headers.get(a)&&void 0===e.fallback)return s;if("page"!==i&&"fallback"!==i)return s;if(function(e,t=""){const r=new URL(e.url).pathname.slice(t.length);return Ce(r)||je(r)}(r.request,t))return s;if(function(e,t=""){const r=new URL(e.url);return("/"===t?r.pathname.slice(t.length):r.pathname.slice(t.length+1)).startsWith("_server-islands")}(r.request,t))return s;const{currentLocale:c}=r;switch(e.strategy){case"manual":return s;case"domains-prefix-other-locales":if(qe(e,c)){const e=m(r,s);if(e)return e}break;case"pathname-prefix-other-locales":{const e=m(r,s);if(e)return e;break}case"domains-prefix-always-no-redirect":if(qe(e,c)){const e=l(r,s);if(e)return e}break;case"pathname-prefix-always-no-redirect":{const e=l(r,s);if(e)return e;break}case"pathname-prefix-always":{const e=p(r,s);if(e)return e;break}case"domains-prefix-always":if(qe(e,c)){const e=p(r,s);if(e)return e}}return f(r,s)}}function qe(e,t){for(const r of Object.values(e.domainLookupTable))if(r===t)return!1;return!0}function Ne(e,t){const r=e.split("/");for(const e of r)for(const r of t)if("string"==typeof r){if(Ue(e)===Ue(r))return!0}else if(e===r.path)return!0;return!1}function Ue(e){return e.replaceAll("_","-").toLowerCase()}const Fe=new Date(0),He="deleted",We=Symbol.for("astro.responseSent");class ze{constructor(e){this.value=e}json(){if(void 0===this.value)throw new Error("Cannot convert undefined to an object.");return JSON.parse(this.value)}number(){return Number(this.value)}boolean(){return"false"!==this.value&&("0"!==this.value&&Boolean(this.value))}}class Ke{#e;#t;#r;#n;constructor(e){this.#e=e,this.#t=null,this.#r=null,this.#n=!1}delete(e,t){const{maxAge:r,expires:n,...s}=t||{},o={expires:Fe,...s};this.#s().set(e,[He,Z.serialize(e,He,o),!1])}get(e,t=void 0){if(this.#r?.has(e)){let[t,,r]=this.#r.get(e);return r?new ze(t):void 0}const r=this.#o(t);if(e in r){const t=r[e];if(t)return new ze(t)}}has(e,t=void 0){if(this.#r?.has(e)){let[,,t]=this.#r.get(e);return t}return!!this.#o(t)[e]}set(e,t,r){if(this.#n){const e=new Error("Astro.cookies.set() was called after the cookies had already been sent to the browser.\nThis may have happened if this method was called in an imported component.\nPlease make sure that Astro.cookies.set() is only called in the frontmatter of the main page.");e.name="Warning",console.warn(e)}let n;if("string"==typeof t)n=t;else{let e=t.toString();n=e===Object.prototype.toString.call(t)?JSON.stringify(t):e}const s={};if(r&&Object.assign(s,r),this.#s().set(e,[n,Z.serialize(e,n,s),!0]),this.#e[We])throw new i({...u})}merge(e){const t=e.#r;if(t)for(const[e,r]of t)this.#s().set(e,r)}*headers(){if(null!=this.#r)for(const[,e]of this.#r)yield e[1]}static consume(e){return e.#n=!0,e.headers()}#o(e=void 0){return this.#t||this.#a(e),this.#t||(this.#t={}),this.#t}#s(){return this.#r||(this.#r=new Map),this.#r}#a(e=void 0){const t=this.#e.headers.get("cookie");t&&(this.#t=Z.parse(t,e))}}const Be=Symbol.for("astro.cookies");function Ve(e){let t=Reflect.get(e,Be);return null!=t?t:void 0}function*Je(e){const t=Ve(e);if(!t)return[];for(const e of Ke.consume(t))yield e;return[]}const Ge=new Intl.DateTimeFormat([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),Xe={debug:20,info:30,warn:40,error:50,silent:90};function Ye(e,t,r,n,s=!0){const o=e.level,a=e.dest,i={label:r,level:t,message:n,newLine:s};(function(e,t){return Xe[e]<=Xe[t]})(o,t)&&a.write(i)}function Ze(e,t,r,n=!0){return Ye(e,"info",t,r,n)}function Qe(e,t,r,n=!0){return Ye(e,"warn",t,r,n)}function et(e,t,r,n=!0){return Ye(e,"error",t,r,n)}function tt(...e){"_astroGlobalDebug"in globalThis&&globalThis._astroGlobalDebug(...e)}class rt{options;constructor(e){this.options=e}info(e,t,r=!0){Ze(this.options,e,t,r)}warn(e,t,r=!0){Qe(this.options,e,t,r)}error(e,t,r=!0){et(this.options,e,t,r)}debug(e,...t){tt(e,...t)}level(){return this.options.level}forkIntegrationLogger(e){return new nt(this.options,e)}}class nt{options;label;constructor(e,t){this.options=e,this.label=t}fork(e){return new nt(this.options,e)}info(e){Ze(this.options,this.label,e)}warn(e){Qe(this.options,this.label,e)}error(e){et(this.options,this.label,e)}debug(e){tt(this.label,e)}}const st={write(e){let t=console.error;return Xe[e.level]<Xe.error&&(t=console.log),"SKIP_FORMAT"===e.label?t(e.message):t(function({level:e,label:t}){const r=`${Ge.format(new Date)}`,n=[];return"error"===e||"warn"===e?(n.push(l(r)),n.push(`[${e.toUpperCase()}]`)):n.push(r),t&&n.push(`[${t}]`),"error"===e?d(n.join(" ")):"warn"===e?h(n.join(" ")):1===n.length?f(n[0]):f(n[0])+" "+p(n.splice(1).join(" "))}(e)+" "+e.message),!0}},ot=Symbol.for("astro.actionAPIContext"),at=["application/x-www-form-urlencoded","multipart/form-data"];function it(e,t){const r=e.split(";")[0].toLowerCase();return t.some((e=>r===e))}function ct(e){const t=function(e){if(e.routePattern===re)return{from:"rpc",name:e.url.pathname.replace(/^.*\/_actions\//,"")};const t=e.url.searchParams.get(ne.actionName);if(t)return{from:"form",name:t};return}(e),r=Boolean(e.locals._actionPayload);let n;return t&&"POST"===e.request.method&&!r&&(n={calledFrom:t.from,name:t.name,handler:async()=>{const r=Reflect.get(e,sr),n=Pe(r.manifest.trailingSlash,r.manifest.buildFormat)?me(t.name):t.name,s=await r.getAction(n);let o;try{o=await async function(e){const t=e.headers.get("content-type"),r=e.headers.get("Content-Length");if(!t)return;if(it(t,at))return await e.clone().formData();if(it(t,["application/json"]))return"0"===r?void 0:await e.clone().json();throw new TypeError("Unsupported content type")}(e.request)}catch(e){if(e instanceof TypeError)return{data:void 0,error:new Q({code:"UNSUPPORTED_MEDIA_TYPE"})};throw e}const{props:a,getActionResult:i,callAction:c,redirect:u,...l}=e;Reflect.set(l,ot,!0);return s.bind(l)(o)}}),{action:n,setActionResult:function(t,r){e.locals._actionPayload={actionResult:r,actionName:t}},serializeActionResult:te,deserializeActionResult:ee}}function ut(e){return"_actionPayload"in e}function lt(e){return t=>{if(ut(e)&&t.toString()===se(e._actionPayload.actionName))return ee(e._actionPayload.actionResult)}}function dt(e){return(t,r)=>{Reflect.set(e,ot,!0);return t.bind(e)(r)}}function ht(e){if("*"===e)return[{locale:e,qualityValue:void 0}];const t=[],r=e.split(",").map((e=>e.trim()));for(const e of r){const r=e.split(";").map((e=>e.trim())),n=r[0],s=r[1];if(r)if(s&&s.startsWith("q=")){const e=Number.parseFloat(s.slice(2));Number.isNaN(e)||e>1?t.push({locale:n,qualityValue:void 0}):t.push({locale:n,qualityValue:e})}else t.push({locale:n,qualityValue:void 0})}return t}function ft(e,t){const r=function(e){return e.map((e=>"string"==typeof e?e:e.codes[0]))}(t).map(Ue);return e.filter((e=>"*"===e.locale||r.includes(Ue(e.locale)))).sort(((e,t)=>e.qualityValue&&t.qualityValue?Math.sign(t.qualityValue-e.qualityValue):0))}function pt(e,t,r){for(const r of e.split("/"))for(const e of t)if("string"==typeof e){if(!r.includes(e))continue;if(Ue(e)===Ue(r))return e}else{if(e.path===r)return e.codes.at(0);for(const t of e.codes)if(Ue(t)===Ue(r))return t}for(const e of t)if("string"==typeof e){if(e===r)return e}else if(e.path===r)return e.codes.at(0)}function mt(e,t,r,n,s){if(t.bodyUsed)throw new i(v);return function({url:e,headers:t,method:r="GET",body:n,logger:s,isPrerendered:o=!1,routePattern:a,init:i}){const c=o?void 0:t instanceof Headers?t:new Headers(Object.entries(t).filter((([e])=>!e.startsWith(":"))));"string"==typeof e&&(e=new URL(e)),o&&(e.search="");const u=new Request(e,{method:r,headers:c,body:o?null:n,...i});if(o){let e=u.headers;const{value:t,writable:r,...n}=Object.getOwnPropertyDescriptor(u,"headers")||{};Object.defineProperty(u,"headers",{...n,get:()=>(s.warn(null,`\`Astro.request.headers\` was used when rendering the route \`${a}'\`. \`Astro.request.headers\` is not available on prerendered pages. If you need access to request headers, make sure that the page is server-rendered using \`export const prerender = false;\` or by setting \`output\` to \`"server"\` in your Astro config to make all your pages server-rendered by default.`),e),set(t){e=t}})}return u}({url:e,method:t.method,body:t.body,isPrerendered:r,logger:n,headers:r?{}:t.headers,routePattern:s,init:{referrer:t.referrer,referrerPolicy:t.referrerPolicy,mode:t.mode,credentials:t.credentials,cache:t.cache,redirect:t.redirect,integrity:t.integrity,signal:t.signal,keepalive:t.keepalive,duplex:"half"}})}function gt(e){const t=Reflect.get(e,y);return t?decodeURIComponent(t):new URL(e.url).pathname}const yt=["application/x-www-form-urlencoded","multipart/form-data","text/plain"],vt=["GET","HEAD","OPTIONS"];function wt(){return(e,t)=>{const{request:r,url:n,isPrerendered:s}=e;if(s)return t();if(vt.includes(r.method))return t();const o=r.headers.get("origin")===n.origin;if(r.headers.has("content-type")){if(function(e){if(e)for(const t of yt)if(e.toLowerCase().includes(t))return!0;return!1}(r.headers.get("content-type"))&&!o)return new Response(`Cross-site ${r.method} form submissions are forbidden`,{status:403})}else if(!o)return new Response(`Cross-site ${r.method} form submissions are forbidden`,{status:403});return t()}}const bt=["string","number","undefined"];function Rt(e,t){const r=Object.entries(e).reduce(((e,r)=>{!function([e,t],r){if(!bt.includes(typeof t))throw new i({...k,message:k.message(e,t,typeof t),location:{file:r}})}(r,t.component);const[n,s]=r;return void 0!==s&&(e[n]="string"==typeof s?ye(s):s.toString()),e}),{});return t.generate(r)}function xt(e,t){return function(r,n={}){let{pageSize:s,params:o,props:a}=n;const c=s||10,u="page",l=o||{},d=a||{};let h;if(e.params.includes(`...${u}`))h=!1;else{if(!e.params.includes(`${u}`))throw new i({...E,message:E.message(u)});h=!0}const f=Math.max(1,Math.ceil(r.length/c)),p=[...Array(f).keys()].map((n=>{const s=n+1,o=c===1/0?0:(s-1)*c,a=Math.min(o+c,r.length),i={...l,[u]:h||s>1?String(s):void 0},p=kt(e.generate({...i}),t),m=s===f?void 0:kt(e.generate({...i,page:String(s+1)}),t),g=1===s?void 0:kt(e.generate({...i,page:h||s-1!=1?String(s-1):void 0}),t),y=1===s?void 0:kt(e.generate({...i,page:h?"1":void 0}),t),v=s===f?void 0:kt(e.generate({...i,page:String(f)}),t);return{params:i,props:{...d,page:{data:r.slice(o,a),start:o,end:a-1,size:c,total:r.length,currentPage:s,lastPage:f,url:{current:p,next:m,prev:g,first:y,last:v}}}}}));return p}}function kt(e,t){let r=pe(t,e);return""===r&&(r="/"),r}async function Et({mod:e,route:t,routeCache:r,logger:n,ssr:s,base:o}){const a=r.get(t);if(!e)throw new Error("This is an error caused by Astro and not your code. Please file an issue.");if(a?.staticPaths)return a.staticPaths;if(function(e,{ssr:t,route:r}){if((!t||r.prerender)&&!e.getStaticPaths)throw new i({...w,location:{file:r.component}})}(e,{ssr:s,route:t}),s&&!t.prerender){const e=Object.assign([],{keyed:new Map});return r.set(t,{...a,staticPaths:e}),e}let c=[];if(!e.getStaticPaths)throw new Error("Unexpected Error.");c=await e.getStaticPaths({paginate:xt(t,o)}),function(e,t,r){if(!Array.isArray(e))throw new i({...b,message:b.message(typeof e),location:{file:r.component}});e.forEach((e=>{if("object"==typeof e&&Array.isArray(e)||null===e)throw new i({...R,message:R.message(Array.isArray(e)?"array":typeof e)});if(void 0===e.params||null===e.params||e.params&&0===Object.keys(e.params).length)throw new i({...x,location:{file:r.component}});for(const[r,n]of Object.entries(e.params))void 0!==n&&"string"!=typeof n&&"number"!=typeof n&&t.warn("router",`getStaticPaths() returned an invalid path param: "${r}". A string, number or undefined value was expected, but got \`${JSON.stringify(n)}\`.`),"string"==typeof n&&""===n&&t.warn("router",`getStaticPaths() returned an invalid path param: "${r}". \`undefined\` expected for an optional param, but got empty string.`)}))}(c,n,t);const u=c;u.keyed=new Map;for(const e of u){const r=Rt(e.params,t);u.keyed.set(r,e)}return r.set(t,{...a,staticPaths:u}),u}class Pt{logger;cache={};runtimeMode;constructor(e,t="production"){this.logger=e,this.runtimeMode=t}clearAll(){this.cache={}}set(e,t){const r=this.key(e);"production"===this.runtimeMode&&this.cache[r]?.staticPaths&&this.logger.warn(null,`Internal Warning: route cache overwritten. (${r})`),this.cache[r]=t}get(e){return this.cache[this.key(e)]}key(e){return`${e.route}_${e.component}`}}function At(e){const t=new URL(e.hrefRoot);return[{instance:ae,matchesComponent:e=>e.href===new URL(P,t).href,route:oe.route,component:P},{instance:Te(e),matchesComponent:e=>e.href===new URL(Le,t).href,route:"/_server-islands/[name]",component:Le}]}class St{constructor(e,t,r,n,s,o,a,i=t.adapterName,c=t.clientDirectives,u=t.inlinedScripts,l=t.compressHTML,d=t.i18n,h=t.middleware,f=new Pt(e,r),p=(t.site?new URL(t.site):void 0),m=At(t),g=t.actions){this.logger=e,this.manifest=t,this.runtimeMode=r,this.renderers=n,this.resolve=s,this.serverLike=o,this.streaming=a,this.adapterName=i,this.clientDirectives=c,this.inlinedScripts=u,this.compressHTML=l,this.i18n=d,this.middleware=h,this.routeCache=f,this.site=p,this.defaultRoutes=m,this.actions=g,this.internalMiddleware=[],"manual"!==d?.strategy&&this.internalMiddleware.push(_e(d,t.base,t.trailingSlash,t.buildFormat))}internalMiddleware;resolvedMiddleware=void 0;resolvedActions=void 0;async getMiddleware(){if(this.resolvedMiddleware)return this.resolvedMiddleware;if(this.middleware){const e=(await this.middleware()).onRequest??ie;return this.manifest.checkOrigin?this.resolvedMiddleware=It(wt(),e):this.resolvedMiddleware=e,this.resolvedMiddleware}return this.resolvedMiddleware=ie,this.resolvedMiddleware}setActions(e){this.resolvedActions=e}async getActions(){return this.resolvedActions?this.resolvedActions:this.actions?this.actions:{server:{}}}async getAction(e){const t=e.split(".").map((e=>decodeURIComponent(e)));let{server:r}=await this.getActions();if(!r||"object"!=typeof r)throw new TypeError(`Expected \`server\` export in actions file to be an object. Received ${typeof r}.`);for(const e of t){if(!(e in r))throw new i({...A,message:A.message(t.join("."))});r=r[e]}if("function"!=typeof r)throw new TypeError(`Expected handler for action ${t.join(".")} to be a function. Received ${typeof r}.`);return r}}const Ot={default:()=>new Response(null,{status:301})},Lt={page:()=>Promise.resolve(Ot),onRequest:(e,t)=>t(),renderers:[]};async function Dt(e){const{logger:t,mod:r,routeData:n,routeCache:s,pathname:o,serverLike:a,base:c}=e;if(!n||n.pathname)return{};if(function(e){return"redirect"===e?.type}(n)||function(e){return"fallback"===e?.type}(n)||n.component===P)return{};const u=await Et({mod:r,route:n,routeCache:s,logger:t,ssr:a,base:c}),l=Tt(n,o),d=function(e,t,r,n){const s=Rt(t,r),o=e.keyed.get(s);if(o)return o;n.debug("router",`findPathItemByKey() - Unexpected cache miss looking for ${s}`)}(u,l,n,t);if(!d&&(!a||n.prerender))throw new i({...S,message:S.message(o),hint:S.hint([n.component])});r&&function(e,t,r){if("endpoint"===e.type&&t.getStaticPaths){const t=e.segments[e.segments.length-1],n=Object.values(r),s=n[n.length-1];if(1===t.length&&t[0].dynamic&&void 0===s)throw new i({...O,message:O.message(e.route),hint:O.hint(e.component),location:{file:e.component}})}}(n,r,l);return d?.props?{...d.props}:{}}function Tt(e,t){if(!e.params.length)return{};const r=e.pattern.exec(t)||e.fallbackRoutes.map((e=>e.pattern.exec(t))).find((e=>e));if(!r)return{};const n={};return e.params.forEach(((e,t)=>{e.startsWith("...")?n[e.slice(3)]=r[t+1]?r[t+1]:void 0:n[e]=r[t+1]})),n}class $t{#i;#c;#u;constructor(e,t,r){if(this.#i=e,this.#c=t,this.#u=r,t)for(const e of Object.keys(t)){if(void 0!==this[e])throw new i({...L,message:L.message(e)});Object.defineProperty(this,e,{get:()=>!0,enumerable:!0})}}has(e){return!!this.#c&&Boolean(this.#c[e])}async render(e,t=[]){if(!this.#c||!this.has(e))return;const r=this.#i;if(Array.isArray(t)){if(t.length>0){const n=this.#c[e],s="function"==typeof n?await n(r):await n,o=function(e){if(!e)return;const t=e?.expressions?.filter((e=>!1===I(e)));return 1===t?.length?t[0]:void 0}(s);if(o){const e=async()=>"function"==typeof o?o(...t):o;return await D(r,e).then((e=>e))}if("function"==typeof s)return await T(r,s(...t)).then((e=>null!=e?String(e):e))}}else this.#u.warn(null,`Expected second parameter to be an array, received a ${typeof t}. If you're trying to pass an array as a single argument and getting unexpected results, make sure you're passing your array as a item of an array. Ex: Astro.slots.render('default', [["Hello", "World"]])`);const n=await D(r,this.#c[e]);return $(r,n)}}function It(...e){const t=e.filter((e=>!!e)),r=t.length;return r?(e,n)=>{let s;return function e(o,a){const c=(0,t[o])(a,(async t=>{if(o<r-1){if(t){let e;e=t instanceof Request?t:t instanceof URL?new Request(t,a.request):new Request(new URL(t,a.url.origin),a.request);const r=Reflect.get(a,sr),{routeData:n,pathname:o}=await r.tryRewrite(t,a.request);if(!0===r.serverLike&&!1===a.isPrerendered&&!0===n.prerender)throw new i({...M,message:M.message(a.url.pathname,o,n.component),hint:M.hint(n.component)});s=t,a.request=e,a.url=new URL(e.url),a.cookies=new Ke(e),a.params=Tt(n,o)}return e(o+1,a)}return n(t??s)}));return c}(0,e)}:(e,t)=>t()}const Mt=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Ct=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,jt=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function _t(e,t){if(!("__proto__"===e||"constructor"===e&&t&&"object"==typeof t&&"prototype"in t))return t;!function(e){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`)}(e)}function qt(e,t={}){if("string"!=typeof e)return e;const r=e.trim();if('"'===e[0]&&e.endsWith('"')&&!e.includes("\\"))return r.slice(1,-1);if(r.length<=9){const e=r.toLowerCase();if("true"===e)return!0;if("false"===e)return!1;if("undefined"===e)return;if("null"===e)return null;if("nan"===e)return Number.NaN;if("infinity"===e)return Number.POSITIVE_INFINITY;if("-infinity"===e)return Number.NEGATIVE_INFINITY}if(!jt.test(e)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(Mt.test(e)||Ct.test(e)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,_t)}return JSON.parse(e)}catch(r){if(t.strict)throw r;return e}}function Nt(e,...t){try{return(r=e(...t))&&"function"==typeof r.then?r:Promise.resolve(r)}catch(e){return Promise.reject(e)}var r}function Ut(e){if(function(e){const t=typeof e;return null===e||"object"!==t&&"function"!==t}(e))return String(e);if(function(e){const t=Object.getPrototypeOf(e);return!t||t.isPrototypeOf(Object)}(e)||Array.isArray(e))return JSON.stringify(e);if("function"==typeof e.toJSON)return Ut(e.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Ft="base64:";function Ht(e){return"string"==typeof e?e:Ft+function(e){if(globalThis.Buffer)return Buffer.from(e).toString("base64");return globalThis.btoa(String.fromCodePoint(...e))}(e)}function Wt(e){return"string"!=typeof e?e:e.startsWith(Ft)?function(e){if(globalThis.Buffer)return Buffer.from(e,"base64");return Uint8Array.from(globalThis.atob(e),(e=>e.codePointAt(0)))}(e.slice(7)):e}function zt(e){return e&&e.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function Kt(...e){return zt(e.join(":"))}function Bt(e){return(e=zt(e))?e+":":""}const Vt=()=>{const e=new Map;return{name:"memory",getInstance:()=>e,hasItem:t=>e.has(t),getItem:t=>e.get(t)??null,getItemRaw:t=>e.get(t)??null,setItem(t,r){e.set(t,r)},setItemRaw(t,r){e.set(t,r)},removeItem(t){e.delete(t)},getKeys:()=>[...e.keys()],clear(){e.clear()},dispose(){e.clear()}}};function Jt(e={}){const t={mounts:{"":e.driver||Vt()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=e=>{for(const r of t.mountpoints)if(e.startsWith(r))return{base:r,relativeKey:e.slice(r.length),driver:t.mounts[r]};return{base:"",relativeKey:e,driver:t.mounts[""]}},n=(e,r)=>t.mountpoints.filter((t=>t.startsWith(e)||r&&e.startsWith(t))).map((r=>({relativeBase:e.length>r.length?e.slice(r.length):void 0,mountpoint:r,driver:t.mounts[r]}))),s=(e,r)=>{if(t.watching){r=zt(r);for(const n of t.watchListeners)n(e,r)}},o=async()=>{if(t.watching){for(const e in t.unwatch)await t.unwatch[e]();t.unwatch={},t.watching=!1}},a=(e,t,n)=>{const s=new Map,o=e=>{let t=s.get(e.base);return t||(t={driver:e.driver,base:e.base,items:[]},s.set(e.base,t)),t};for(const n of e){const e="string"==typeof n,s=zt(e?n:n.key),a=e?void 0:n.value,i=e||!n.options?t:{...t,...n.options},c=r(s);o(c).items.push({key:s,value:a,relativeKey:c.relativeKey,options:i})}return Promise.all([...s.values()].map((e=>n(e)))).then((e=>e.flat()))},i={hasItem(e,t={}){e=zt(e);const{relativeKey:n,driver:s}=r(e);return Nt(s.hasItem,n,t)},getItem(e,t={}){e=zt(e);const{relativeKey:n,driver:s}=r(e);return Nt(s.getItem,n,t).then((e=>qt(e)))},getItems:(e,t={})=>a(e,t,(e=>e.driver.getItems?Nt(e.driver.getItems,e.items.map((e=>({key:e.relativeKey,options:e.options}))),t).then((t=>t.map((t=>({key:Kt(e.base,t.key),value:qt(t.value)}))))):Promise.all(e.items.map((t=>Nt(e.driver.getItem,t.relativeKey,t.options).then((e=>({key:t.key,value:qt(e)})))))))),getItemRaw(e,t={}){e=zt(e);const{relativeKey:n,driver:s}=r(e);return s.getItemRaw?Nt(s.getItemRaw,n,t):Nt(s.getItem,n,t).then((e=>Wt(e)))},async setItem(e,t,n={}){if(void 0===t)return i.removeItem(e);e=zt(e);const{relativeKey:o,driver:a}=r(e);a.setItem&&(await Nt(a.setItem,o,Ut(t),n),a.watch||s("update",e))},async setItems(e,t){await a(e,t,(async e=>{if(e.driver.setItems)return Nt(e.driver.setItems,e.items.map((e=>({key:e.relativeKey,value:Ut(e.value),options:e.options}))),t);e.driver.setItem&&await Promise.all(e.items.map((t=>Nt(e.driver.setItem,t.relativeKey,Ut(t.value),t.options))))}))},async setItemRaw(e,t,n={}){if(void 0===t)return i.removeItem(e,n);e=zt(e);const{relativeKey:o,driver:a}=r(e);if(a.setItemRaw)await Nt(a.setItemRaw,o,t,n);else{if(!a.setItem)return;await Nt(a.setItem,o,Ht(t),n)}a.watch||s("update",e)},async removeItem(e,t={}){"boolean"==typeof t&&(t={removeMeta:t}),e=zt(e);const{relativeKey:n,driver:o}=r(e);o.removeItem&&(await Nt(o.removeItem,n,t),(t.removeMeta||t.removeMata)&&await Nt(o.removeItem,n+"$",t),o.watch||s("remove",e))},async getMeta(e,t={}){"boolean"==typeof t&&(t={nativeOnly:t}),e=zt(e);const{relativeKey:n,driver:s}=r(e),o=Object.create(null);if(s.getMeta&&Object.assign(o,await Nt(s.getMeta,n,t)),!t.nativeOnly){const e=await Nt(s.getItem,n+"$",t).then((e=>qt(e)));e&&"object"==typeof e&&("string"==typeof e.atime&&(e.atime=new Date(e.atime)),"string"==typeof e.mtime&&(e.mtime=new Date(e.mtime)),Object.assign(o,e))}return o},setMeta(e,t,r={}){return this.setItem(e+"$",t,r)},removeMeta(e,t={}){return this.removeItem(e+"$",t)},async getKeys(e,t={}){e=Bt(e);const r=n(e,!0);let s=[];const o=[];let a=!0;for(const e of r){e.driver.flags?.maxDepth||(a=!1);const r=await Nt(e.driver.getKeys,e.relativeBase,t);for(const t of r){const r=e.mountpoint+zt(t);s.some((e=>r.startsWith(e)))||o.push(r)}s=[e.mountpoint,...s.filter((t=>!t.startsWith(e.mountpoint)))]}const i=void 0!==t.maxDepth&&!a;return o.filter((r=>(!i||function(e,t){if(void 0===t)return!0;let r=0,n=e.indexOf(":");for(;n>-1;)r++,n=e.indexOf(":",n+1);return r<=t}(r,t.maxDepth))&&function(e,t){return t?e.startsWith(t)&&"$"!==e[e.length-1]:"$"!==e[e.length-1]}(r,e)))},async clear(e,t={}){e=Bt(e),await Promise.all(n(e,!1).map((async e=>{if(e.driver.clear)return Nt(e.driver.clear,e.relativeBase,t);if(e.driver.removeItem){const r=await e.driver.getKeys(e.relativeBase||"",t);return Promise.all(r.map((r=>e.driver.removeItem(r,t))))}})))},async dispose(){await Promise.all(Object.values(t.mounts).map((e=>Xt(e))))},watch:async e=>(await(async()=>{if(!t.watching){t.watching=!0;for(const e in t.mounts)t.unwatch[e]=await Gt(t.mounts[e],s,e)}})(),t.watchListeners.push(e),async()=>{t.watchListeners=t.watchListeners.filter((t=>t!==e)),0===t.watchListeners.length&&await o()}),async unwatch(){t.watchListeners=[],await o()},mount(e,r){if((e=Bt(e))&&t.mounts[e])throw new Error(`already mounted at ${e}`);return e&&(t.mountpoints.push(e),t.mountpoints.sort(((e,t)=>t.length-e.length))),t.mounts[e]=r,t.watching&&Promise.resolve(Gt(r,s,e)).then((r=>{t.unwatch[e]=r})).catch(console.error),i},async unmount(e,r=!0){(e=Bt(e))&&t.mounts[e]&&(t.watching&&e in t.unwatch&&(t.unwatch[e]?.(),delete t.unwatch[e]),r&&await Xt(t.mounts[e]),t.mountpoints=t.mountpoints.filter((t=>t!==e)),delete t.mounts[e])},getMount(e=""){e=zt(e)+":";const t=r(e);return{driver:t.driver,base:t.base}},getMounts(e="",t={}){e=zt(e);return n(e,t.parents).map((e=>({driver:e.driver,base:e.mountpoint})))},keys:(e,t={})=>i.getKeys(e,t),get:(e,t={})=>i.getItem(e,t),set:(e,t,r={})=>i.setItem(e,t,r),has:(e,t={})=>i.hasItem(e,t),del:(e,t={})=>i.removeItem(e,t),remove:(e,t={})=>i.removeItem(e,t)};return i}function Gt(e,t,r){return e.watch?e.watch(((e,n)=>t(e,r+n))):()=>{}}async function Xt(e){"function"==typeof e.dispose&&await Nt(e.dispose)}const Yt={"azure-app-configuration":"unstorage/drivers/azure-app-configuration",azureAppConfiguration:"unstorage/drivers/azure-app-configuration","azure-cosmos":"unstorage/drivers/azure-cosmos",azureCosmos:"unstorage/drivers/azure-cosmos","azure-key-vault":"unstorage/drivers/azure-key-vault",azureKeyVault:"unstorage/drivers/azure-key-vault","azure-storage-blob":"unstorage/drivers/azure-storage-blob",azureStorageBlob:"unstorage/drivers/azure-storage-blob","azure-storage-table":"unstorage/drivers/azure-storage-table",azureStorageTable:"unstorage/drivers/azure-storage-table","capacitor-preferences":"unstorage/drivers/capacitor-preferences",capacitorPreferences:"unstorage/drivers/capacitor-preferences","cloudflare-kv-binding":"unstorage/drivers/cloudflare-kv-binding",cloudflareKVBinding:"unstorage/drivers/cloudflare-kv-binding","cloudflare-kv-http":"unstorage/drivers/cloudflare-kv-http",cloudflareKVHttp:"unstorage/drivers/cloudflare-kv-http","cloudflare-r2-binding":"unstorage/drivers/cloudflare-r2-binding",cloudflareR2Binding:"unstorage/drivers/cloudflare-r2-binding",db0:"unstorage/drivers/db0","deno-kv-node":"unstorage/drivers/deno-kv-node",denoKVNode:"unstorage/drivers/deno-kv-node","deno-kv":"unstorage/drivers/deno-kv",denoKV:"unstorage/drivers/deno-kv","fs-lite":"unstorage/drivers/fs-lite",fsLite:"unstorage/drivers/fs-lite",fs:"unstorage/drivers/fs",github:"unstorage/drivers/github",http:"unstorage/drivers/http",indexedb:"unstorage/drivers/indexedb",localstorage:"unstorage/drivers/localstorage","lru-cache":"unstorage/drivers/lru-cache",lruCache:"unstorage/drivers/lru-cache",memory:"unstorage/drivers/memory",mongodb:"unstorage/drivers/mongodb","netlify-blobs":"unstorage/drivers/netlify-blobs",netlifyBlobs:"unstorage/drivers/netlify-blobs",null:"unstorage/drivers/null",overlay:"unstorage/drivers/overlay",planetscale:"unstorage/drivers/planetscale",redis:"unstorage/drivers/redis",s3:"unstorage/drivers/s3","session-storage":"unstorage/drivers/session-storage",sessionStorage:"unstorage/drivers/session-storage",uploadthing:"unstorage/drivers/uploadthing",upstash:"unstorage/drivers/upstash","vercel-blob":"unstorage/drivers/vercel-blob",vercelBlob:"unstorage/drivers/vercel-blob","vercel-kv":"unstorage/drivers/vercel-kv",vercelKV:"unstorage/drivers/vercel-kv"},Zt=Symbol(),Qt="astro-session",er=/^[\w-]+$/,tr=(e,t)=>xe(e,{URL:e=>new URL(e)}),rr=(e,t)=>ce(e,{URL:e=>e instanceof URL&&e.href});class nr{#l;#d;#h;#f;#p;#m;#g;#y=new Set;#v=new Set;#w=!1;#b=!1;#R=!0;static#x=new Map;constructor(e,{cookie:t=Qt,...r}){let n;if(this.#l=e,"object"==typeof t){const{name:e=Qt,...r}=t;this.#f=e,n=r}else this.#f=t||Qt;this.#h={sameSite:"lax",secure:!0,path:"/",...n,httpOnly:!0},this.#d=r}async get(e){return(await this.#k()).get(e)?.data}async has(e){return(await this.#k()).has(e)}async keys(){return(await this.#k()).keys()}async values(){return[...(await this.#k()).values()].map((e=>e.data))}async entries(){return[...(await this.#k()).entries()].map((([e,t])=>[e,t.data]))}delete(e){this.#m?.delete(e),this.#R&&this.#v.add(e),this.#w=!0}set(e,t,{ttl:r}={}){if(!e)throw new i({...C,message:"The session key was not provided."});let n;try{n=tr(JSON.parse(rr(t)))}catch(t){throw new i({...C,message:`The session data for ${e} could not be serialized.`,hint:"See the devalue library for all supported types: https://github.com/rich-harris/devalue"},{cause:t})}this.#b||(this.#E(),this.#b=!0),this.#m??=new Map;const s=r??this.#d.ttl,o="number"==typeof s?Date.now()+1e3*s:s;this.#m.set(e,{data:n,expires:o}),this.#w=!0}destroy(){this.#P()}async regenerate(){let e=new Map;try{e=await this.#k()}catch(e){console.error("Failed to load session data during regeneration:",e)}const t=this.#g;this.#g=crypto.randomUUID(),this.#m=e,await this.#E(),t&&this.#p&&this.#p.removeItem(t).catch((e=>{console.error("Failed to remove old session data:",e)}))}async[Zt](){if(!this.#w&&!this.#y.size)return;const e=await this.#A();if(this.#w&&this.#m){const t=await this.#k();this.#v.forEach((e=>t.delete(e)));const r=this.#S();let n;try{n=rr(t)}catch(e){throw new i({...C,message:C.message("The session data could not be serialized.",this.#d.driver)},{cause:e})}await e.setItem(r,n),this.#w=!1}if(this.#y.size>0){const t=[...this.#y].map((t=>e.removeItem(t).catch((e=>{console.error(`Failed to clean up session ${t}:`,e)}))));await Promise.all(t),this.#y.clear()}}get sessionID(){return this.#g}async#E(){if(!er.test(this.#f))throw new i({...C,message:"Invalid cookie name. Cookie names can only contain letters, numbers, and dashes."});const e=this.#S();this.#l.set(this.#f,e,this.#h)}async#k(){const e=await this.#A();if(this.#m&&!this.#R)return this.#m;this.#m??=new Map;const t=await e.get(this.#S());if(!t)return this.#m;try{const e=tr(t);if(!(e instanceof Map))throw await this.#P(),new i({...j,message:j.message("The session data was an invalid type.",this.#d.driver)});const r=Date.now();for(const[t,n]of e){const e="number"==typeof n.expires&&n.expires<r;this.#m.has(t)||this.#v.has(t)||e||this.#m.set(t,n)}return this.#R=!1,this.#m}catch(e){if(await this.#P(),e instanceof i)throw e;throw new i({...j,message:j.message("The session data could not be parsed.",this.#d.driver)},{cause:e})}}#P(){this.#g&&this.#y.add(this.#g),this.#f&&this.#l.delete(this.#f,this.#h),this.#g=void 0,this.#m=void 0,this.#w=!0}#S(){return this.#g??=this.#l.get(this.#f)?.value??crypto.randomUUID(),this.#g}async#A(){if(this.#p)return this.#p;if(nr.#x.has(this.#d.driver))return this.#p=nr.#x.get(this.#d.driver),this.#p;if("test"===this.#d.driver)return this.#p=this.#d.options.mockStorage,this.#p;if("fs"!==this.#d.driver&&"fsLite"!==this.#d.driver&&"fs-lite"!==this.#d.driver||(this.#d.options??={},this.#d.driver="fs-lite",this.#d.options.base??=".astro/session"),!this.#d?.driver)throw new i({...j,message:j.message("No driver was defined in the session configuration and the adapter did not provide a default driver.")});let e=null;const t=await async function(e){if(!e)return null;try{if("fs"===e)return await import.meta.resolve(Yt.fsLite);if(e in Yt)return await import.meta.resolve(Yt[e])}catch{return null}return e}(this.#d.driver);try{this.#d.driverModule?e=(await this.#d.driverModule()).default:t&&(e=(await import(t)).default)}catch(e){if("ERR_MODULE_NOT_FOUND"===e.code)throw new i({...j,message:j.message(e.message.includes(`Cannot find package '${t}'`)?"The driver module could not be found.":e.message,this.#d.driver)},{cause:e});throw e}if(!e)throw new i({...j,message:j.message("The module did not export a driver.",this.#d.driver)});try{return this.#p=Jt({driver:e(this.#d.options)}),nr.#x.set(this.#d.driver,this.#p),this.#p}catch(e){throw new i({...j,message:j.message("Unknown error",this.#d.driver)},{cause:e})}}}const sr=Symbol.for("context.routes");class or{constructor(e,t,r,n,s,o,a,i,c,u=new Ke(o),l=Tt(a,s),d=new URL(o.url),h={},f=void 0,p=(e.manifest.sessionConfig?new nr(u,e.manifest.sessionConfig):void 0)){this.pipeline=e,this.locals=t,this.middleware=r,this.actions=n,this.pathname=s,this.request=o,this.routeData=a,this.status=i,this.clientAddress=c,this.cookies=u,this.params=l,this.url=d,this.props=h,this.partial=f,this.session=p}isRewriting=!1;counter=0;static async create({locals:e={},middleware:t,pathname:r,pipeline:n,request:s,routeData:o,clientAddress:a,status:i=200,props:c,partial:u,actions:l}){const d=await n.getMiddleware(),h=l??await n.getActions();return function(e,t){Reflect.set(e,y,encodeURIComponent(t))}(s,r),new or(n,e,It(...n.internalMiddleware,t??d),h,r,s,o,i,a,void 0,void 0,void 0,c,u)}async render(e,t={}){const{cookies:r,middleware:n,pipeline:s}=this,{logger:c,serverLike:u,streaming:l,manifest:d}=s,h=Object.keys(this.props).length>0?this.props:await Dt({mod:e,routeData:this.routeData,routeCache:this.pipeline.routeCache,pathname:this.pathname,logger:c,serverLike:u,base:d.base}),f=this.createActionAPIContext(),p=this.createAPIContext(h,f);if(this.counter++,4===this.counter)return new Response("Loop Detected",{status:508,statusText:"Astro detected a loop where you tried to call the rewriting logic more than four times."});if("redirect"===(y=this.routeData).type&&y.redirect&&Ae(y.redirect))return Se(this);var y;const v=await async function(e,t,r){let n,s=!1,o=e(t,(async e=>(s=!0,n=r(t,e),n)));return await Promise.resolve(o).then((async e=>{if(s){if(void 0!==e){if(e instanceof Response==0)throw new i(g);return e}if(n)return n;throw new i(g)}if(void 0===e)throw new i(m);if(e instanceof Response==0)throw new i(g);return e}))}(n,p,(async(n,u)=>{if(u){s.logger.debug("router","Called rewriting to:",u);const{routeData:t,componentInstance:r,pathname:n,newUrl:o}=await s.tryRewrite(u,this.request);if(!0===this.pipeline.serverLike&&!1===this.routeData.prerender&&!0===t.prerender)throw new i({...M,message:M.message(this.pathname,n,t.component),hint:M.hint(t.component)});this.routeData=t,e=r,u instanceof Request?this.request=u:this.request=mt(o,this.request,t.prerender,this.pipeline.logger,this.routeData.route),this.isRewriting=!0,this.url=new URL(this.request.url),this.cookies=new Ke(this.request),this.params=Tt(t,n),this.pathname=n,this.status=200}let d;if(!n.isPrerendered){const{action:e,setActionResult:t,serializeActionResult:r}=ct(n);if("form"===e?.calledFrom){const n=await e.handler();t(e.name,r(n))}}switch(this.routeData.type){case"endpoint":d=await J(e,n,this.routeData.prerender,c);break;case"redirect":return Se(this);case"page":{const r=await this.createResult(e,f);try{d=await K(r,e?.default,h,t,l,this.routeData)}catch(e){throw r.cancelled=!0,e}d.headers.set(o,"page"),"/404"!==this.routeData.route&&"/500"!==this.routeData.route||d.headers.set(a,"no"),this.isRewriting&&d.headers.set(B,V);break}case"fallback":return new Response(null,{status:500,headers:{[o]:"fallback"}})}const p=Ve(d);return p&&r.merge(p),d}));return v.headers.get(o)&&v.headers.delete(o),function(e,t){Reflect.set(e,Be,t)}(v,r),v}createAPIContext(e,t){return Reflect.set(t,sr,this.pipeline),Object.assign(t,{props:e,redirect:(e,t=302)=>new Response(null,{status:t,headers:{Location:e}}),getActionResult:lt(t.locals),callAction:dt(t)})}async#O(e){this.pipeline.logger.debug("router","Calling rewrite: ",e);const{routeData:t,componentInstance:r,newUrl:n,pathname:s}=await this.pipeline.tryRewrite(e,this.request);if(!0===this.pipeline.serverLike&&!1===this.routeData.prerender&&!0===t.prerender)throw new i({...M,message:M.message(this.pathname,s,t.component),hint:M.hint(t.component)});return this.routeData=t,e instanceof Request?this.request=e:this.request=mt(n,this.request,t.prerender,this.pipeline.logger,this.routeData.route),this.url=new URL(this.request.url),this.cookies=new Ke(this.request),this.params=Tt(t,s),this.pathname=s,this.isRewriting=!0,this.status=200,await this.render(r)}createActionAPIContext(){const e=this,{cookies:t,params:r,pipeline:n,url:s,session:o}=this,a=`Astro v${_}`;return{cookies:t,routePattern:this.routeData.route,isPrerendered:this.routeData.prerender,get clientAddress(){return e.getClientAddress()},get currentLocale(){return e.computeCurrentLocale()},generator:a,get locals(){return e.locals},set locals(e){throw new i(q)},params:r,get preferredLocale(){return e.computePreferredLocale()},get preferredLocaleList(){return e.computePreferredLocaleList()},rewrite:async e=>await this.#O(e),request:this.request,site:n.site,url:s,get originPathname(){return gt(e.request)},session:o}}async createResult(e,t){const{cookies:r,pathname:n,pipeline:s,routeData:o,status:a}=this,{clientDirectives:c,inlinedScripts:u,compressHTML:l,manifest:d,renderers:h,resolve:f}=s,{links:p,scripts:m,styles:g}=await s.headElements(o),y=await s.componentMetadata(o)??d.componentMetadata,v=new Headers({"Content-Type":"text/html"}),w="boolean"==typeof this.partial?this.partial:Boolean(e.partial),b=ut(this.locals)?ee(this.locals._actionPayload.actionResult):void 0,R={status:b?.error?b?.error.status:a,statusText:b?.error?b?.error.type:"OK",get headers(){return v},set headers(e){throw new i(W)}},x={base:d.base,userAssetsBase:d.userAssetsBase,cancelled:!1,clientDirectives:c,inlinedScripts:u,componentMetadata:y,compressHTML:l,cookies:r,createAstro:(e,r,n)=>this.createAstro(x,e,r,n,t),links:p,params:this.params,partial:w,pathname:n,renderers:h,resolve:f,response:R,request:this.request,scripts:m,styles:g,actionResult:b,serverIslandNameMap:d.serverIslandNameMap??new Map,key:d.key,trailingSlash:d.trailingSlash,_metadata:{hasHydrationScript:!1,rendererSpecificHydrationScripts:new Set,hasRenderedHead:!1,renderedScripts:new Set,hasDirectives:new Set,headInTree:!1,extraHead:[],propagators:new Set}};return x}#L;createAstro(e,t,r,n,s){let o;o=this.isRewriting?this.#L=this.createAstroPagePartial(e,t,s):this.#L??=this.createAstroPagePartial(e,t,s);const a={props:r,self:null},i=Object.assign(Object.create(o),a);let c;return Object.defineProperty(i,"slots",{get:()=>(c||(c=new $t(e,n,this.pipeline.logger)),c)}),i}createAstroPagePartial(e,t,r){const n=this,{cookies:s,locals:o,params:a,pipeline:c,url:l,session:d}=this,{response:h}=e,f=dt(r);return{generator:t.generator,glob:t.glob,routePattern:this.routeData.route,isPrerendered:this.routeData.prerender,cookies:s,session:d,get clientAddress(){return n.getClientAddress()},get currentLocale(){return n.computeCurrentLocale()},params:a,get preferredLocale(){return n.computePreferredLocale()},get preferredLocaleList(){return n.computePreferredLocaleList()},locals:o,redirect:(e,t=302)=>{if(this.request[z])throw new i({...u});return new Response(null,{status:t,headers:{Location:e}})},rewrite:async e=>await this.#O(e),request:this.request,response:h,site:c.site,getActionResult:lt(o),get callAction(){return f},url:l,get originPathname(){return gt(n.request)}}}getClientAddress(){const{pipeline:e,request:t,routeData:r,clientAddress:n}=this;if(r.prerender)throw new i(N);if(n)return n;if(U in t)return Reflect.get(t,U);if(e.adapterName)throw new i({...F,message:F.message(e.adapterName)});throw new i(H)}#D;computeCurrentLocale(){const{url:e,pipeline:{i18n:t},routeData:r}=this;if(!t)return;const{defaultLocale:n,locales:s,strategy:o}=t,a="pathname-prefix-other-locales"===o||"domains-prefix-other-locales"===o?n:void 0;if(this.#D)return this.#D;let i;if(r.component===Le){let e=this.request.headers.get("referer");e&&(URL.canParse(e)&&(e=new URL(e).pathname),i=pt(e,s,n))}else{let t=r.pathname;if(!r.pattern.test(e.pathname))for(const n of r.fallbackRoutes)if(n.pattern.test(e.pathname)){t=n.pathname;break}t=t&&!function(e){return Ce(e.route)||je(e.route)}(r)?t:e.pathname,i=pt(t,s,n)}return this.#D=i??a,this.#D}#T;computePreferredLocale(){const{pipeline:{i18n:e},request:t}=this;if(e)return this.#T??=function(e,t){const r=e.headers.get("Accept-Language");let n;if(r){const e=ft(ht(r),t).at(0);if(e&&"*"!==e.locale)for(const r of t)if("string"==typeof r)Ue(r)===Ue(e.locale)&&(n=r);else for(const t of r.codes)Ue(t)===Ue(e.locale)&&(n=r.path)}return n}(t,e.locales)}#$;computePreferredLocaleList(){const{pipeline:{i18n:e},request:t}=this;if(e)return this.#$??=function(e,t){const r=e.headers.get("Accept-Language");let n=[];if(r){const e=ft(ht(r),t);if(1===e.length&&"*"===e.at(0).locale)return t.map((e=>"string"==typeof e?e:e.codes.at(0)));if(e.length>0)for(const r of e)for(const e of t)if("string"==typeof e)Ue(e)===Ue(r.locale)&&n.push(e);else for(const t of e.codes)t===r.locale&&n.push(e.path)}return n}(t,e.locales)}}function ar(e,t,r){if(r){const t=function(e,t){if(!t)return"";if("string"==typeof t)return t;const r=e.slice(1);return t[r]?t[r]:t.fallback}(ve(e),r);return pe(t,we(e))}return t?ge(pe(t,we(e))):e}function ir(e,t,r){return new Set(e.map((e=>function(e,t,r){return"inline"===e.type?{props:{},children:e.content}:{props:{rel:"stylesheet",href:ar(e.src,t,r)},children:""}}(e,t,r))))}function cr(e,t,r){return"external"===e.type?function(e,t,r){return{props:{type:"module",src:ar(e,t,r)},children:""}}(e.value,t,r):{props:{type:"module"},children:e.value}}class ur extends St{#I;static create(e,{logger:t,manifest:r,runtimeMode:n,renderers:s,resolve:o,serverLike:a,streaming:i,defaultRoutes:c}){const u=new ur(t,r,n,s,o,a,i,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,c);return u.#I=e,u}headElements(e){const t=this.manifest.routes.find((t=>t.routeData===e)),r=new Set,n=new Set,s=ir(t?.styles??[]);for(const e of t?.scripts??[])"stage"in e?"head-inline"===e.stage&&n.add({props:{},children:e.children}):n.add(cr(e));return{links:r,styles:s,scripts:n}}componentMetadata(){}async getComponentByRoute(e){return(await this.getModuleForRoute(e)).page()}async tryRewrite(e,t){const{newUrl:r,pathname:n,routeData:s}=function({payload:e,routes:t,request:r,trailingSlash:n,buildFormat:s,base:o}){let a;a=e instanceof URL?e:e instanceof Request?new URL(e.url):new URL(e,new URL(r.url).origin);let i=a.pathname;const c=Pe(n,s);"/"!==o&&a.pathname.startsWith(o)&&(i=c?fe(a.pathname):me(a.pathname),i=i.slice(o.length)),!i.startsWith("/")&&c&&a.pathname.endsWith("/")&&(i=ge(i)),"/"!==i||"/"===o||c||(i=""),a.pathname=pe(...[o,i].filter(Boolean));const u=decodeURI(i);let l;for(const e of t)if(e.pattern.test(u)){l=e;break}if(l)return{routeData:l,newUrl:a,pathname:u};{const e=t.find((e=>"/404"===e.route));return e?{routeData:e,newUrl:a,pathname:i}:{routeData:oe,newUrl:a,pathname:i}}}({payload:e,request:t,routes:this.manifest?.routes.map((e=>e.routeData)),trailingSlash:this.manifest.trailingSlash,buildFormat:this.manifest.buildFormat,base:this.manifest.base});return{newUrl:r,pathname:n,componentInstance:await this.getComponentByRoute(s),routeData:s}}async getModuleForRoute(e){for(const t of this.defaultRoutes)if(e.component===t.component)return{page:()=>Promise.resolve(t.instance),renderers:[]};if("redirect"===e.type)return Lt;if(this.manifest.pageMap){const t=this.manifest.pageMap.get(e.component);if(!t)throw new Error(`Unexpectedly unable to find a component instance for route ${e.route}`);return await t()}if(this.manifest.pageModule)return this.manifest.pageModule;throw new Error("Astro couldn't find the correct page to render, probably because it wasn't correctly mapped for SSR usage. This is an internal error, please file an issue.")}}class lr{#M;#I;#u=new rt({dest:st,level:"info"});#C;#j;#_;#q=!1;constructor(e,t=!0){this.#M=e,this.#I={routes:e.routes.map((e=>e.routeData))},ue(this.#I),this.#C=me(this.#M.base),this.#j=this.#N(this.#I,t),this.#_=new nt(this.#u.options,this.#M.adapterName)}getAdapterLogger(){return this.#_}#N(e,t=!1){return ur.create(e,{logger:this.#u,manifest:this.#M,runtimeMode:"production",renderers:this.#M.renderers,defaultRoutes:At(this.#M),resolve:async e=>{if(!(e in this.#M.entryModules))throw new Error(`Unable to resolve [${e}]`);const t=this.#M.entryModules[e];return t.startsWith("data:")||0===t.length?t:ar(t,this.#M.base,this.#M.assetsPrefix)},serverLike:!0,streaming:t})}set setManifestData(e){this.#I=e}removeBase(e){return e.startsWith(this.#M.base)?e.slice(this.#C.length+1):e}#U(e){const t=new URL(e.url),r=ge(this.removeBase(t.pathname));try{return decodeURI(r)}catch(e){return this.getAdapterLogger().error(e.toString()),r}}match(e){const t=new URL(e.url);if(this.#M.assets.has(t.pathname))return;let r=this.#F(e);r||(r=ge(this.removeBase(t.pathname)));let n=$e(decodeURI(r),this.#I);return n&&!n.prerender?n:void 0}#F(e){let t;const r=new URL(e.url);if(this.#M.i18n&&("domains-prefix-always"===this.#M.i18n.strategy||"domains-prefix-other-locales"===this.#M.i18n.strategy||"domains-prefix-always-no-redirect"===this.#M.i18n.strategy)){let n=e.headers.get("X-Forwarded-Host"),s=e.headers.get("X-Forwarded-Proto");if(s?s+=":":s=r.protocol,n||(n=e.headers.get("Host")),n&&s){n=n.split(":")[0];try{let e;const o=new URL(`${s}//${n}`);for(const[t,r]of Object.entries(this.#M.i18n.domainLookupTable)){const n=new URL(t);if(o.host===n.host&&o.protocol===n.protocol){e=r;break}}e&&(t=ge(pe(Ue(e),this.removeBase(r.pathname))),r.pathname.endsWith("/")&&(t=fe(t)))}catch(e){this.#u.error("router",`Astro tried to parse ${s}//${n} as an URL, but it threw a parsing error. Check the X-Forwarded-Host and X-Forwarded-Proto headers.`),this.#u.error("router",`Error: ${e}`)}}}return t}#H(e){const{trailingSlash:t}=this.#M;if("/"===e||e.startsWith("/_"))return e;const r=be(e,"never"!==t);return r!==e?r:"ignore"===t?e:"always"!==t||Re(e)?"never"===t?me(e):e:fe(e)}async render(e,t){let r,n,s,o;const c=new URL(e.url),u=this.#H(c.pathname);if(u!==c.pathname){const t="GET"===e.method?301:308;return new Response(function({status:e,absoluteLocation:t,relativeLocation:r,from:n}){return`<!doctype html>\n<title>Redirecting to: ${r}</title>\n<meta http-equiv="refresh" content="${302===e?2:0};url=${r}">\n<meta name="robots" content="noindex">\n<link rel="canonical" href="${t}">\n<body>\n\t<a href="${r}">Redirecting ${n?`from <code>${n}</code> `:""}to <code>${r}</code></a>\n</body>`}({status:t,relativeLocation:c.pathname,absoluteLocation:u,from:e.url}),{status:t,headers:{location:u+c.search}})}if(o=t?.addCookieHeader,s=t?.clientAddress??Reflect.get(e,U),r=t?.routeData,n=t?.locals,r&&(this.#u.debug("router","The adapter "+this.#M.adapterName+" provided a custom RouteData for ",e.url),this.#u.debug("router","RouteData:\n"+r)),n&&"object"!=typeof n){const t=new i(G);return this.#u.error(null,t.stack),this.#W(e,{status:500,error:t,clientAddress:s})}if(r||(r=this.match(e),this.#u.debug("router","Astro matched the following route for "+e.url),this.#u.debug("router","RouteData:\n"+r)),!r)return this.#u.debug("router","Astro hasn't found routes that match "+e.url),this.#u.debug("router","Here's the available routes:\n",this.#I),this.#W(e,{locals:n,status:404,clientAddress:s});const l=this.#U(e),d=this.#z(r,l);let h,f;try{const t=await this.#j.getModuleForRoute(r),o=await or.create({pipeline:this.#j,locals:n,pathname:l,request:e,routeData:r,status:d,clientAddress:s});f=o.session,h=await o.render(await t.page())}catch(t){return this.#u.error(null,t.stack||t.message||String(t)),this.#W(e,{locals:n,status:500,error:t,clientAddress:s})}finally{await(f?.[Zt]())}if(X.includes(h.status)&&"no"!==h.headers.get(a))return this.#W(e,{locals:n,response:h,status:h.status,error:500===h.status?null:void 0,clientAddress:s});if(h.headers.has(a)&&h.headers.delete(a),o)for(const e of lr.getSetCookieFromResponse(h))h.headers.append("set-cookie",e);return Reflect.set(h,z,!0),h}setCookieHeaders(e){return Je(e)}static getSetCookieFromResponse=Je;async#W(e,{locals:t,status:r,response:n,skipMiddleware:s=!1,error:o,clientAddress:a}){const i=$e(`/${r}${"always"===this.#M.trailingSlash?"/":""}`,this.#I),c=new URL(e.url);if(i){if(i.prerender){const t=i.route.endsWith(`/${r}`)?".html":"",s=new URL(`${this.#C}/${r}${t}`,c);if(s.toString()!==e.url){const e=await fetch(s.toString()),t={status:r};return this.#K(e,n,t)}}const u=await this.#j.getModuleForRoute(i);let l;try{const c=await or.create({locals:t,pipeline:this.#j,middleware:s?ie:void 0,pathname:this.#U(e),request:e,routeData:i,status:r,props:{error:o},clientAddress:a});l=c.session;const d=await c.render(await u.page());return this.#K(d,n)}catch{if(!1===s)return this.#W(e,{locals:t,status:r,response:n,skipMiddleware:!0,clientAddress:a})}finally{await(l?.[Zt]())}}const u=this.#K(new Response(null,{status:r}),n);return Reflect.set(u,z,!0),u}#K(e,t,r){if(!t)return void 0!==r?new Response(e.body,{status:r.status,statusText:e.statusText,headers:e.headers}):e;const n=r?.status?r.status:200===t.status?e.status:t.status;try{t.headers.delete("Content-type")}catch{}const s=new Map([...Array.from(e.headers),...Array.from(t.headers)]),o=new Headers;for(const[e,t]of s)o.set(e,t);return new Response(e.body,{status:n,statusText:200===n?e.statusText:t.statusText,headers:o})}#z(e,t){if(!e.pattern.test(t))for(const r of e.fallbackRoutes)if(r.pattern.test(t))return 302;const r=me(e.route);return r.endsWith("/404")?404:r.endsWith("/500")?500:200}}class dr extends lr{match(e){return e instanceof Request||(e=dr.createRequest(e,{skipBody:!0})),super.match(e)}render(e,t,r){return e instanceof Request||(e=dr.createRequest(e)),super.render(e,t,r)}static createRequest(e,{skipBody:t=!1}={}){const r=e=>e?.toString()?.split(",").map((e=>e.trim()))?.[0],n="encrypted"in e.socket&&e.socket.encrypted?"https":"http",s=r(e.headers["x-forwarded-proto"])??n,o=r(e.headers["x-forwarded-host"]),a=e.headers.host??e.headers[":authority"],i=o??a,c=r(e.headers["x-forwarded-port"]);let u;try{const t=hr(i,c);u=new URL(`${s}://${t}${e.url}`)}catch{const e=hr(a,c);u=new URL(`${n}://${e}`)}const l={method:e.method||"GET",headers:fr(e)};"HEAD"!==l.method&&"GET"!==l.method&&!1===t&&Object.assign(l,function(e){if(void 0!==e.body){if("string"==typeof e.body&&e.body.length>0)return{body:Buffer.from(e.body)};if("object"==typeof e.body&&null!==e.body&&Object.keys(e.body).length>0)return{body:Buffer.from(JSON.stringify(e.body))};if("object"==typeof e.body&&null!==e.body&&void 0!==e.body[Symbol.asyncIterator])return pr(e.body)}return pr(e)}(e));const d=new Request(u,l),h=r(e.headers["x-forwarded-for"])||e.socket?.remoteAddress;return h&&Reflect.set(d,U,h),d}static async writeResponse(e,t){const{status:r,headers:n,body:s,statusText:o}=e;if(t instanceof he||(t.statusMessage=o),t.writeHead(r,(e=>{if(!e)return;const t=Object.fromEntries(e.entries());if(0!==Object.keys(t).length){if(e.has("set-cookie")){const r=e.getSetCookie();r.length>1&&(t["set-cookie"]=r)}return t}})(n)),!s)return t.end();try{const e=s.getReader();t.on("close",(()=>{e.cancel().catch((e=>{console.error(`There was an uncaught error in the middle of the stream while rendering ${t.req.url}.`,e)}))}));let r=await e.read();for(;!r.done;)t.write(r.value),r=await e.read();t.end()}catch(e){t.write("Internal server error",(()=>{e instanceof Error?t.destroy(e):t.destroy()}))}}}function hr(e,t){return"string"==typeof e&&/:\d+$/.test(e)?e:`${e}${t?`:${t}`:""}`}function fr(e){const t=new Headers;for(const[r,n]of Object.entries(e.headers))if(void 0!==n)if(Array.isArray(n))for(const e of n)t.append(r,e);else t.append(r,n);return t}function pr(e){return{body:e,duplex:"half"}}globalThis.crypto||Object.defineProperty(globalThis,"crypto",{value:de.webcrypto}),globalThis.File||Object.defineProperty(globalThis,"File",{value:le.File});var mr={exports:{}};function gr(e,t){void 0===t&&(t={});for(var r=function(e){for(var t=[],r=0;r<e.length;){var n=e[r];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)t.push({type:"CHAR",index:r,value:e[r++]});else{var s=1,o="";if("?"===e[i=r+1])throw new TypeError('Pattern cannot start with "?" at '+i);for(;i<e.length;)if("\\"!==e[i]){if(")"===e[i]){if(0==--s){i++;break}}else if("("===e[i]&&(s++,"?"!==e[i+1]))throw new TypeError("Capturing groups are not allowed at "+i);o+=e[i++]}else o+=e[i++]+e[i++];if(s)throw new TypeError("Unbalanced pattern at "+r);if(!o)throw new TypeError("Missing pattern at "+r);t.push({type:"PATTERN",index:r,value:o}),r=i}else{for(var a="",i=r+1;i<e.length;){var c=e.charCodeAt(i);if(!(c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||95===c))break;a+=e[i++]}if(!a)throw new TypeError("Missing parameter name at "+r);t.push({type:"NAME",index:r,value:a}),r=i}else t.push({type:"CLOSE",index:r,value:e[r++]});else t.push({type:"OPEN",index:r,value:e[r++]});else t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});else t.push({type:"MODIFIER",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}(e),n=t.prefixes,s=void 0===n?"./":n,o="[^"+wr(t.delimiter||"/#?")+"]+?",a=[],i=0,c=0,u="",l=function(e){if(c<r.length&&r[c].type===e)return r[c++].value},d=function(e){var t=l(e);if(void 0!==t)return t;var n=r[c],s=n.type,o=n.index;throw new TypeError("Unexpected "+s+" at "+o+", expected "+e)},h=function(){for(var e,t="";e=l("CHAR")||l("ESCAPED_CHAR");)t+=e;return t};c<r.length;){var f=l("CHAR"),p=l("NAME"),m=l("PATTERN");if(p||m){var g=f||"";-1===s.indexOf(g)&&(u+=g,g=""),u&&(a.push(u),u=""),a.push({name:p||i++,prefix:g,suffix:"",pattern:m||o,modifier:l("MODIFIER")||""})}else{var y=f||l("ESCAPED_CHAR");if(y)u+=y;else if(u&&(a.push(u),u=""),l("OPEN")){g=h();var v=l("NAME")||"",w=l("PATTERN")||"",b=h();d("CLOSE"),a.push({name:v||(w?i++:""),pattern:v&&!w?o:w,prefix:g,suffix:b,modifier:l("MODIFIER")||""})}else d("END")}}return a}function yr(e,t){void 0===t&&(t={});var r=br(t),n=t.encode,s=void 0===n?function(e){return e}:n,o=t.validate,a=void 0===o||o,i=e.map((function(e){if("object"==typeof e)return new RegExp("^(?:"+e.pattern+")$",r)}));return function(t){for(var r="",n=0;n<e.length;n++){var o=e[n];if("string"!=typeof o){var c=t?t[o.name]:void 0,u="?"===o.modifier||"*"===o.modifier,l="*"===o.modifier||"+"===o.modifier;if(Array.isArray(c)){if(!l)throw new TypeError('Expected "'+o.name+'" to not repeat, but got an array');if(0===c.length){if(u)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var d=0;d<c.length;d++){var h=s(c[d],o);if(a&&!i[n].test(h))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but got "'+h+'"');r+=o.prefix+h+o.suffix}}else if("string"!=typeof c&&"number"!=typeof c){if(!u){var f=l?"an array":"a string";throw new TypeError('Expected "'+o.name+'" to be '+f)}}else{h=s(String(c),o);if(a&&!i[n].test(h))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but got "'+h+'"');r+=o.prefix+h+o.suffix}}else r+=o}return r}}function vr(e,t,r){void 0===r&&(r={});var n=r.decode,s=void 0===n?function(e){return e}:n;return function(r){var n=e.exec(r);if(!n)return!1;for(var o=n[0],a=n.index,i=Object.create(null),c=function(e){if(void 0===n[e])return"continue";var r=t[e-1];"*"===r.modifier||"+"===r.modifier?i[r.name]=n[e].split(r.prefix+r.suffix).map((function(e){return s(e,r)})):i[r.name]=s(n[e],r)},u=1;u<n.length;u++)c(u);return{path:o,index:a,params:i}}}function wr(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function br(e){return e&&e.sensitive?"":"i"}function Rr(e,t,r){void 0===r&&(r={});for(var n=r.strict,s=void 0!==n&&n,o=r.start,a=void 0===o||o,i=r.end,c=void 0===i||i,u=r.encode,l=void 0===u?function(e){return e}:u,d="["+wr(r.endsWith||"")+"]|$",h="["+wr(r.delimiter||"/#?")+"]",f=a?"^":"",p=0,m=e;p<m.length;p++){var g=m[p];if("string"==typeof g)f+=wr(l(g));else{var y=wr(l(g.prefix)),v=wr(l(g.suffix));if(g.pattern)if(t&&t.push(g),y||v)if("+"===g.modifier||"*"===g.modifier){var w="*"===g.modifier?"?":"";f+="(?:"+y+"((?:"+g.pattern+")(?:"+v+y+"(?:"+g.pattern+"))*)"+v+")"+w}else f+="(?:"+y+"("+g.pattern+")"+v+")"+g.modifier;else f+="("+g.pattern+")"+g.modifier;else f+="(?:"+y+v+")"+g.modifier}}if(c)s||(f+=h+"?"),f+=r.endsWith?"(?="+d+")":"$";else{var b=e[e.length-1],R="string"==typeof b?h.indexOf(b[b.length-1])>-1:void 0===b;s||(f+="(?:"+h+"(?="+d+"))?"),R||(f+="(?="+h+"|"+d+")")}return new RegExp(f,br(r))}function xr(e,t,r){return e instanceof RegExp?function(e,t){if(!t)return e;var r=e.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)t.push({name:n,prefix:"",suffix:"",modifier:"",pattern:""});return e}(e,t):Array.isArray(e)?function(e,t,r){var n=e.map((function(e){return xr(e,t,r).source}));return new RegExp("(?:"+n.join("|")+")",br(r))}(e,t,r):function(e,t,r){return Rr(gr(e,r),t,r)}(e,t,r)}const kr=Y(Object.freeze(Object.defineProperty({__proto__:null,compile:function(e,t){return yr(gr(e,t),t)},match:function(e,t){var r=[];return vr(xr(e,r,t),r,t)},parse:gr,pathToRegexp:xr,regexpToFunction:vr,tokensToFunction:yr,tokensToRegexp:Rr},Symbol.toStringTag,{value:"Module"})));function Er(e,t){void 0===t&&(t={});for(var r=function(e){for(var t=[],r=0;r<e.length;){var n=e[r];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)t.push({type:"CHAR",index:r,value:e[r++]});else{var s=1,o="";if("?"===e[i=r+1])throw new TypeError('Pattern cannot start with "?" at '.concat(i));for(;i<e.length;)if("\\"!==e[i]){if(")"===e[i]){if(0==--s){i++;break}}else if("("===e[i]&&(s++,"?"!==e[i+1]))throw new TypeError("Capturing groups are not allowed at ".concat(i));o+=e[i++]}else o+=e[i++]+e[i++];if(s)throw new TypeError("Unbalanced pattern at ".concat(r));if(!o)throw new TypeError("Missing pattern at ".concat(r));t.push({type:"PATTERN",index:r,value:o}),r=i}else{for(var a="",i=r+1;i<e.length;){var c=e.charCodeAt(i);if(!(c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||95===c))break;a+=e[i++]}if(!a)throw new TypeError("Missing parameter name at ".concat(r));t.push({type:"NAME",index:r,value:a}),r=i}else t.push({type:"CLOSE",index:r,value:e[r++]});else t.push({type:"OPEN",index:r,value:e[r++]});else t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});else t.push({type:"MODIFIER",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}(e),n=t.prefixes,s=void 0===n?"./":n,o=t.delimiter,a=void 0===o?"/#?":o,i=[],c=0,u=0,l="",d=function(e){if(u<r.length&&r[u].type===e)return r[u++].value},h=function(e){var t=d(e);if(void 0!==t)return t;var n=r[u],s=n.type,o=n.index;throw new TypeError("Unexpected ".concat(s," at ").concat(o,", expected ").concat(e))},f=function(){for(var e,t="";e=d("CHAR")||d("ESCAPED_CHAR");)t+=e;return t},p=function(e){var t=i[i.length-1],r=e||(t&&"string"==typeof t?t:"");if(t&&!r)throw new TypeError('Must have text between two parameters, missing text after "'.concat(t.name,'"'));return!r||function(e){for(var t=0,r=a;t<r.length;t++){var n=r[t];if(e.indexOf(n)>-1)return!0}return!1}(r)?"[^".concat(Sr(a),"]+?"):"(?:(?!".concat(Sr(r),")[^").concat(Sr(a),"])+?")};u<r.length;){var m=d("CHAR"),g=d("NAME"),y=d("PATTERN");if(g||y){var v=m||"";-1===s.indexOf(v)&&(l+=v,v=""),l&&(i.push(l),l=""),i.push({name:g||c++,prefix:v,suffix:"",pattern:y||p(v),modifier:d("MODIFIER")||""})}else{var w=m||d("ESCAPED_CHAR");if(w)l+=w;else if(l&&(i.push(l),l=""),d("OPEN")){v=f();var b=d("NAME")||"",R=d("PATTERN")||"",x=f();h("CLOSE"),i.push({name:b||(R?c++:""),pattern:b&&!R?p(v):R,prefix:v,suffix:x,modifier:d("MODIFIER")||""})}else h("END")}}return i}function Pr(e,t){void 0===t&&(t={});var r=Or(t),n=t.encode,s=void 0===n?function(e){return e}:n,o=t.validate,a=void 0===o||o,i=e.map((function(e){if("object"==typeof e)return new RegExp("^(?:".concat(e.pattern,")$"),r)}));return function(t){for(var r="",n=0;n<e.length;n++){var o=e[n];if("string"!=typeof o){var c=t?t[o.name]:void 0,u="?"===o.modifier||"*"===o.modifier,l="*"===o.modifier||"+"===o.modifier;if(Array.isArray(c)){if(!l)throw new TypeError('Expected "'.concat(o.name,'" to not repeat, but got an array'));if(0===c.length){if(u)continue;throw new TypeError('Expected "'.concat(o.name,'" to not be empty'))}for(var d=0;d<c.length;d++){var h=s(c[d],o);if(a&&!i[n].test(h))throw new TypeError('Expected all "'.concat(o.name,'" to match "').concat(o.pattern,'", but got "').concat(h,'"'));r+=o.prefix+h+o.suffix}}else if("string"!=typeof c&&"number"!=typeof c){if(!u){var f=l?"an array":"a string";throw new TypeError('Expected "'.concat(o.name,'" to be ').concat(f))}}else{h=s(String(c),o);if(a&&!i[n].test(h))throw new TypeError('Expected "'.concat(o.name,'" to match "').concat(o.pattern,'", but got "').concat(h,'"'));r+=o.prefix+h+o.suffix}}else r+=o}return r}}function Ar(e,t,r){void 0===r&&(r={});var n=r.decode,s=void 0===n?function(e){return e}:n;return function(r){var n=e.exec(r);if(!n)return!1;for(var o=n[0],a=n.index,i=Object.create(null),c=function(e){if(void 0===n[e])return"continue";var r=t[e-1];"*"===r.modifier||"+"===r.modifier?i[r.name]=n[e].split(r.prefix+r.suffix).map((function(e){return s(e,r)})):i[r.name]=s(n[e],r)},u=1;u<n.length;u++)c(u);return{path:o,index:a,params:i}}}function Sr(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function Or(e){return e&&e.sensitive?"":"i"}function Lr(e,t,r){void 0===r&&(r={});for(var n=r.strict,s=void 0!==n&&n,o=r.start,a=void 0===o||o,i=r.end,c=void 0===i||i,u=r.encode,l=void 0===u?function(e){return e}:u,d=r.delimiter,h=void 0===d?"/#?":d,f=r.endsWith,p="[".concat(Sr(void 0===f?"":f),"]|$"),m="[".concat(Sr(h),"]"),g=a?"^":"",y=0,v=e;y<v.length;y++){var w=v[y];if("string"==typeof w)g+=Sr(l(w));else{var b=Sr(l(w.prefix)),R=Sr(l(w.suffix));if(w.pattern)if(t&&t.push(w),b||R)if("+"===w.modifier||"*"===w.modifier){var x="*"===w.modifier?"?":"";g+="(?:".concat(b,"((?:").concat(w.pattern,")(?:").concat(R).concat(b,"(?:").concat(w.pattern,"))*)").concat(R,")").concat(x)}else g+="(?:".concat(b,"(").concat(w.pattern,")").concat(R,")").concat(w.modifier);else{if("+"===w.modifier||"*"===w.modifier)throw new TypeError('Can not repeat "'.concat(w.name,'" without a prefix and suffix'));g+="(".concat(w.pattern,")").concat(w.modifier)}else g+="(?:".concat(b).concat(R,")").concat(w.modifier)}}if(c)s||(g+="".concat(m,"?")),g+=r.endsWith?"(?=".concat(p,")"):"$";else{var k=e[e.length-1],E="string"==typeof k?m.indexOf(k[k.length-1])>-1:void 0===k;s||(g+="(?:".concat(m,"(?=").concat(p,"))?")),E||(g+="(?=".concat(m,"|").concat(p,")"))}return new RegExp(g,Or(r))}function Dr(e,t,r){return e instanceof RegExp?function(e,t){if(!t)return e;for(var r=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,s=r.exec(e.source);s;)t.push({name:s[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),s=r.exec(e.source);return e}(e,t):Array.isArray(e)?function(e,t,r){var n=e.map((function(e){return Dr(e,t,r).source}));return new RegExp("(?:".concat(n.join("|"),")"),Or(r))}(e,t,r):function(e,t,r){return Lr(Er(e,r),t,r)}(e,t,r)}const Tr=Y(Object.freeze(Object.defineProperty({__proto__:null,compile:function(e,t){return Pr(Er(e,t),t)},match:function(e,t){var r=[];return Ar(Dr(e,r,t),r,t)},parse:Er,pathToRegexp:Dr,regexpToFunction:Ar,tokensToFunction:Pr,tokensToRegexp:Lr},Symbol.toStringTag,{value:"Module"})));var $r,Ir,Mr,Cr,jr,_r,qr,Nr,Ur,Fr,Hr;function Wr(){if(Ir)return $r;Ir=1;var e,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,s=Object.prototype.hasOwnProperty,o={};((e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:!0})})(o,{collectHasSegments:()=>b,convertCleanUrls:()=>h,convertHeaders:()=>m,convertRedirects:()=>f,convertRewrites:()=>p,convertTrailingSlash:()=>g,getCleanUrls:()=>d,pathToRegexp:()=>u,sourceToRegex:()=>y}),e=o,$r=((e,o,a,i)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let c of n(o))s.call(e,c)||c===a||t(e,c,{get:()=>o[c],enumerable:!(i=r(o,c))||i.enumerable});return e})(t({},"__esModule",{value:!0}),e);var a=ke,i=kr,c=Tr;function u(e,t,r,n){const s=function(e){if(void 0!==e)return e.slice(0)}(r),o=(0,i.pathToRegexp)(t,r,n);try{const i=r,l=(0,c.pathToRegexp)(t,s,n),d=o.toString()!==l.toString();if(process.env.FORCE_PATH_TO_REGEXP_LOG||d){const r=JSON.stringify({path:t,currentRegExp:o.toString(),newRegExp:l.toString()});console.error(`[vc] PATH TO REGEXP PATH DIFF @ #${e}: ${r}`)}const h=(u=s,!((void 0===(a=r)?"undefined":a.toString())===(void 0===u?"undefined":u.toString())));if(process.env.FORCE_PATH_TO_REGEXP_LOG||h){const t=JSON.stringify({isDiffKeys:h,currentKeys:i,newKeys:s});console.error(`[vc] PATH TO REGEXP KEYS DIFF @ #${e}: ${t}`)}}catch(r){const n=r,s=JSON.stringify({path:t,error:n.message});console.error(`[vc] PATH TO REGEXP ERROR @ #${e}: ${s}`)}var a,u;return o}const l="__UN_NAMED_SEGMENT__";function d(e){return e.map(A).filter((e=>e.endsWith(".html"))).map((e=>({html:e,clean:e.slice(0,-5)})))}function h(e,t,r=308){const n=[];if(e){const e=t?"/$1/":"/$1";n.push({src:"^/(?:(.+)/)?index(?:\\.html)?/?$",headers:{Location:e},status:r}),n.push({src:"^/(.*)\\.html/?$",headers:{Location:e},status:r})}return n}function f(e,t=308){return e.map((e=>{const{src:r,segments:n}=y(e.source),s=b(e.has);w(e.has),w(e.missing);try{const o=k(n,s,e.destination,!0);let a;a="boolean"==typeof e.permanent?e.permanent?308:307:e.statusCode?e.statusCode:t;const i={src:r,headers:{Location:o},status:a};return e.has&&(i.has=e.has),e.missing&&(i.missing=e.missing),i}catch(t){throw new Error(`Failed to parse redirect: ${JSON.stringify(e)}`)}}))}function p(e,t){return e.map((e=>{const{src:r,segments:n}=y(e.source),s=b(e.has);w(e.has),w(e.missing);try{const o={src:r,dest:k(n,s,e.destination,!1,t),check:!0};return e.has&&(o.has=e.has),e.missing&&(o.missing=e.missing),e.statusCode&&(o.status=e.statusCode),o}catch(t){throw new Error(`Failed to parse rewrite: ${JSON.stringify(e)}`)}}))}function m(e){return e.map((e=>{const t={},{src:r,segments:n}=y(e.source),s=b(e.has);w(e.has),w(e.missing);const o=n.filter((e=>e!==l)),a={};n.forEach(((e,t)=>{a[e]=P(t)})),s.forEach((e=>{a[e]="$"+e})),e.headers.forEach((({key:e,value:r})=>{(o.length>0||s.length>0)&&(e.includes(":")&&(e=E(e,a)),r.includes(":")&&(r=E(r,a))),t[e]=r}));const i={src:r,headers:t,continue:!0};return e.has&&(i.has=e.has),e.missing&&(i.missing=e.missing),i}))}function g(e,t=308){const r=[];return e?(r.push({src:"^/\\.well-known(?:/.*)?$"}),r.push({src:"^/((?:[^/]+/)*[^/\\.]+)$",headers:{Location:"/$1/"},status:t}),r.push({src:"^/((?:[^/]+/)*[^/]+\\.\\w+)/$",headers:{Location:"/$1"},status:t})):r.push({src:"^/(.*)\\/$",headers:{Location:"/$1"},status:t}),r}function y(e){const t=[],r=u("632",e,t,{strict:!0,sensitive:!0,delimiter:"/"}),n=t.map((e=>e.name)).map((e=>"string"!=typeof e?l:e));return{src:r.source,segments:n}}const v=/\(\?<([a-zA-Z][a-zA-Z0-9]*)>/g,w=(e=[])=>{for(const t of e)"key"in t&&"header"===t.type&&(t.key=t.key.toLowerCase());return e};function b(e){const t=new Set;for(const r of e||[])if(!r.value&&"key"in r&&t.add(r.key),r.value){for(const e of r.value.matchAll(v))e[1]&&t.add(e[1]);"host"===r.type&&t.add("host")}return[...t]}const R=(e,t)=>e.replace(new RegExp(`:${t}`,"g"),`__ESC_COLON_${t}`),x=e=>e.replace(/__ESC_COLON_/gi,":");function k(e,t,r,n,s){const o=e.filter((e=>e!==l));if(!(r.includes(":")&&o.length>0||t.length>0||!n))return r;let i=r;const c={};e.forEach(((e,t)=>{c[e]=P(t),i=R(i,e)})),t.forEach((e=>{c[e]="$"+e,i=R(i,e)}));const d=(0,a.parse)(i,!0);delete d.href,delete d.path,delete d.search,delete d.host;let{pathname:h,hash:f,query:p,hostname:m,...g}=d;h=x(h||""),f=x(f||""),m=x(m||"");let y=new Set;const v=[],w=[],b=[];try{u("528",h,v),u("834",f||"",w),u("712",m||"",b)}catch(e){}y=new Set([...v,...w,...b].map((e=>e.name)).filter((e=>"string"==typeof e))),h=E(h,c,!0),f=f?E(f,c,!0):null,m=m?E(m,c,!0):null;for(const[e,t]of Object.entries(p))Array.isArray(t)?p[e]=t.map((e=>E(x(e),c,!0))):p[e]=E(x(t),c,!0);const k=Object.keys(c);if(!n&&!k.some((e=>!(s&&s.includes(e))&&y.has(e))))for(const e of k)e in p||e===l||(p[e]=c[e]);return(r=(0,a.format)({...g,hostname:m,pathname:h,query:p,hash:f})).replace(/%24/g,"$")}function E(e,t,r){if(!e)return e;if(r)try{return(0,i.compile)(e,{validate:!1})(t)}catch(e){}for(const r of Object.keys(t))e.includes(`:${r}`)&&(e=e.replace(new RegExp(`:${r}\\*`,"g"),`:${r}--ESCAPED_PARAM_ASTERISK`).replace(new RegExp(`:${r}\\?`,"g"),`:${r}--ESCAPED_PARAM_QUESTION`).replace(new RegExp(`:${r}\\+`,"g"),`:${r}--ESCAPED_PARAM_PLUS`).replace(new RegExp(`:${r}(?!\\w)`,"g"),`--ESCAPED_PARAM_COLON${r}`));return e=e.replace(/(:|\*|\?|\+|\(|\)|\{|\})/g,"\\$1").replace(/--ESCAPED_PARAM_PLUS/g,"+").replace(/--ESCAPED_PARAM_COLON/g,":").replace(/--ESCAPED_PARAM_QUESTION/g,"?").replace(/--ESCAPED_PARAM_ASTERISK/g,"*"),(0,i.compile)(`/${e}`,{validate:!1})(t).slice(1)}function P(e){return"$"+(e+1).toString()}function A(e){return e.startsWith("/")?e:"/"+e}return $r}function zr(){if(Cr)return Mr;Cr=1;var e,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,s=Object.prototype.hasOwnProperty,o={};((e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:!0})})(o,{appendRoutesToPhase:()=>i}),e=o,Mr=((e,o,a,i)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let c of n(o))s.call(e,c)||c===a||t(e,c,{get:()=>o[c],enumerable:!(i=r(o,c))||i.enumerable});return e})(t({},"__esModule",{value:!0}),e);var a=Jr();function i({routes:e,newRoutes:t,phase:r}){const n=e?[...e]:[];if(null===t||0===t.length)return n;let s=!1,o=-1;if(n.forEach(((e,t)=>{(0,a.isHandler)(e)&&(e.handle===r?s=!0:s&&(o=t,s=!1))})),s)n.push(...t);else if(null===r){const e=n.findIndex((e=>(0,a.isHandler)(e)&&e.handle));-1===e?n.push(...t):n.splice(e,0,...t)}else o>-1?n.splice(o,0,...t):(n.push({handle:r}),n.push(...t));return n}return Mr}function Kr(){if(_r)return jr;_r=1;var e,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,s=Object.prototype.hasOwnProperty,o={};((e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:!0})})(o,{mergeRoutes:()=>c}),e=o,jr=((e,o,a,i)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let c of n(o))s.call(e,c)||c===a||t(e,c,{get:()=>o[c],enumerable:!(i=r(o,c))||i.enumerable});return e})(t({},"__esModule",{value:!0}),e);var a=Jr();function i(e){const t=[],r=[],n=[];for(const s of e){if((0,a.isHandler)(s))throw new Error(`Unexpected route found in getCheckAndContinue(): ${JSON.stringify(s)}`);s.check&&!s.override?t.push(s):s.continue&&!s.override?r.push(s):n.push(s)}return{checks:t,continues:r,others:n}}function c({userRoutes:e,builds:t}){const r=new Map;let n=null;(e||[]).forEach((e=>{if((0,a.isHandler)(e))n=e.handle;else{const t=r.get(n);t?t.push(e):r.set(n,[e])}}));const s=new Map,o=function(e){const t={};for(const{entrypoint:r,routes:n,use:s}of e)n&&(t[r]||(t[r]={}),t[r][s]=n);return t}(t);Object.keys(o).sort().forEach((e=>{const t=o[e];Object.keys(t).sort().forEach((e=>{let r=null;t[e].forEach((e=>{if((0,a.isHandler)(e))r=e.handle;else{const t=s.get(r);t?t.push(e):s.set(r,[e])}}))}))}));const c=[],u=new Set([null,...r.keys(),...s.keys()]);for(const e of u){const t=r.get(e)||[],n=s.get(e)||[],o=i(n);null!==e&&(t.length>0||n.length>0)&&c.push({handle:e}),c.push(...o.continues),c.push(...t),c.push(...o.checks),c.push(...o.others)}return c}return jr}function Br(){if(Nr)return qr;Nr=1;var e,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,s=Object.prototype.hasOwnProperty,o={};((e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:!0})})(o,{cleanUrlsSchema:()=>d,hasSchema:()=>a,headersSchema:()=>l,redirectsSchema:()=>u,rewritesSchema:()=>c,routesSchema:()=>i,trailingSlashSchema:()=>h}),e=o,qr=((e,o,a,i)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let c of n(o))s.call(e,c)||c===a||t(e,c,{get:()=>o[c],enumerable:!(i=r(o,c))||i.enumerable});return e})(t({},"__esModule",{value:!0}),e);const a={description:"An array of requirements that are needed to match",type:"array",maxItems:16,items:{anyOf:[{type:"object",additionalProperties:!1,required:["type","value"],properties:{type:{description:"The type of request element to check",type:"string",enum:["host"]},value:{description:"A regular expression used to match the value. Named groups can be used in the destination",type:"string",maxLength:4096}}},{type:"object",additionalProperties:!1,required:["type","key"],properties:{type:{description:"The type of request element to check",type:"string",enum:["header","cookie","query"]},key:{description:"The name of the element contained in the particular type",type:"string",maxLength:4096},value:{description:"A regular expression used to match the value. Named groups can be used in the destination",type:"string",maxLength:4096}}}]}},i={type:"array",maxItems:2048,deprecated:!0,description:"A list of routes objects used to rewrite paths to point towards other internal or external paths",example:[{dest:"https://docs.example.com",src:"/docs"}],items:{anyOf:[{type:"object",required:["src"],additionalProperties:!1,properties:{src:{type:"string",maxLength:4096},dest:{type:"string",maxLength:4096},headers:{type:"object",additionalProperties:!1,minProperties:1,maxProperties:100,patternProperties:{"^.{1,256}$":{type:"string",maxLength:4096}}},methods:{type:"array",maxItems:10,items:{type:"string",maxLength:32}},caseSensitive:{type:"boolean"},important:{type:"boolean"},user:{type:"boolean"},continue:{type:"boolean"},override:{type:"boolean"},check:{type:"boolean"},isInternal:{type:"boolean"},status:{type:"integer",minimum:100,maximum:999},locale:{type:"object",additionalProperties:!1,minProperties:1,properties:{redirect:{type:"object",additionalProperties:!1,minProperties:1,maxProperties:100,patternProperties:{"^.{1,256}$":{type:"string",maxLength:4096}}},value:{type:"string",maxLength:4096},path:{type:"string",maxLength:4096},cookie:{type:"string",maxLength:4096},default:{type:"string",maxLength:4096}}},middleware:{type:"number"},middlewarePath:{type:"string"},middlewareRawSrc:{type:"array",items:{type:"string"}},has:a,missing:a}},{type:"object",required:["handle"],additionalProperties:!1,properties:{handle:{type:"string",maxLength:32,enum:["error","filesystem","hit","miss","resource","rewrite"]}}}]}},c={type:"array",maxItems:2048,description:"A list of rewrite definitions.",items:{type:"object",additionalProperties:!1,required:["source","destination"],properties:{source:{description:"A pattern that matches each incoming pathname (excluding querystring).",type:"string",maxLength:4096},destination:{description:"An absolute pathname to an existing resource or an external URL.",type:"string",maxLength:4096},has:a,missing:a,statusCode:{description:"An optional integer to override the status code of the response.",type:"integer",minimum:100,maximum:999}}}},u={title:"Redirects",type:"array",maxItems:2048,description:"A list of redirect definitions.",items:{type:"object",additionalProperties:!1,required:["source","destination"],properties:{source:{description:"A pattern that matches each incoming pathname (excluding querystring).",type:"string",maxLength:4096},destination:{description:"A location destination defined as an absolute pathname or external URL.",type:"string",maxLength:4096},permanent:{description:"A boolean to toggle between permanent and temporary redirect. When `true`, the status code is `308`. When `false` the status code is `307`.",type:"boolean"},statusCode:{description:"An optional integer to define the status code of the redirect.",private:!0,type:"integer",minimum:100,maximum:999},has:a,missing:a}}},l={type:"array",maxItems:2048,description:"A list of header definitions.",items:{type:"object",additionalProperties:!1,required:["source","headers"],properties:{source:{description:"A pattern that matches each incoming pathname (excluding querystring)",type:"string",maxLength:4096},headers:{description:"An array of key/value pairs representing each response header.",type:"array",maxItems:1024,items:{type:"object",additionalProperties:!1,required:["key","value"],properties:{key:{type:"string",maxLength:4096},value:{type:"string",maxLength:4096}}}},has:a,missing:a}}},d={description:"When set to `true`, all HTML files and Serverless Functions will have their extension removed. When visiting a path that ends with the extension, a 308 response will redirect the client to the extensionless path.",type:"boolean"},h={description:"When `false`, visiting a path that ends with a forward slash will respond with a `308` status code and redirect to the path without the trailing slash.",type:"boolean"};return qr}function Vr(){if(Fr)return Ur;Fr=1;var e,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,s=Object.prototype.hasOwnProperty;return e={},Ur=((e,o,a,i)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let c of n(o))s.call(e,c)||c===a||t(e,c,{get:()=>o[c],enumerable:!(i=r(o,c))||i.enumerable});return e})(t({},"__esModule",{value:!0}),e)}function Jr(){return Hr||(Hr=1,function(e){var t,r=Object.defineProperty,n=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,o=Object.prototype.hasOwnProperty,a=(e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let c of s(t))o.call(e,c)||c===a||r(e,c,{get:()=>t[c],enumerable:!(i=n(t,c))||i.enumerable});return e},i=(e,t,r)=>(a(e,t,"default"),r&&a(r,t,"default")),c={};((e,t)=>{for(var n in t)r(e,n,{get:t[n],enumerable:!0})})(c,{appendRoutesToPhase:()=>d.appendRoutesToPhase,getCleanUrls:()=>f.getCleanUrls,getTransformedRoutes:()=>k,isHandler:()=>m,isValidHandleValue:()=>g,mergeRoutes:()=>h.mergeRoutes,normalizeRoutes:()=>y}),e.exports=(t=c,a(r({},"__esModule",{value:!0}),t));var u=ke,l=Wr(),d=zr(),h=Kr();i(c,Br(),e.exports);var f=Wr();i(c,Vr(),e.exports);const p=new Set(["filesystem","hit","miss","rewrite","error","resource"]);function m(e){return void 0!==e.handle}function g(e){return p.has(e)}function y(e){if(!e||0===e.length)return{routes:e,error:null};const t=[],r=[],n=[];e.forEach(((e,s)=>{const o={...e};t.push(o);const a=Object.keys(o);if(m(o)){const{handle:e}=o;if(1!==a.length){const e=a.find((e=>"handle"!==e));n.push(`Route at index ${s} has unknown property \`${e}\`.`)}else g(e)?r.includes(e)?n.push(`Route at index ${s} is a duplicate. Please use one \`handle: ${e}\` at most.`):r.push(e):n.push(`Route at index ${s} has unknown handle value \`handle: ${e}\`.`)}else if(o.src){o.src.startsWith("^")||(o.src=`^${o.src}`),o.src.endsWith("$")||(o.src=`${o.src}$`),o.src=o.src.replace(/\\\//g,"/");const e=v("Route",s,o.src);e&&n.push(e);const t=r[r.length-1];"hit"===t?(o.dest&&n.push(`Route at index ${s} cannot define \`dest\` after \`handle: hit\`.`),o.status&&n.push(`Route at index ${s} cannot define \`status\` after \`handle: hit\`.`),o.continue||n.push(`Route at index ${s} must define \`continue: true\` after \`handle: hit\`.`)):"miss"===t&&(o.dest&&!o.check?n.push(`Route at index ${s} must define \`check: true\` after \`handle: miss\`.`):o.dest||o.continue||n.push(`Route at index ${s} must define \`continue: true\` after \`handle: miss\`.`))}else n.push(`Route at index ${s} must define either \`handle\` or \`src\` property.`)}));const s=n.length>0?R("invalid_route",n,"https://vercel.link/routes-json","Learn More"):null;return{routes:t,error:s}}function v(e,t,r){try{new RegExp(r)}catch(n){return`${e} at index ${t} has invalid \`${"Route"===e?"src":"source"}\` regular expression "${r}".`}return null}function w(e,t,{source:r,destination:n,has:s}){let o=new Set;const a=new Set;try{o=new Set((0,l.sourceToRegex)(r).segments)}catch(n){return{message:`${e} at index ${t} has invalid \`source\` pattern "${r}".`,link:"https://vercel.link/invalid-route-source-pattern"}}if(n){try{const{hostname:e,pathname:t,query:r}=(0,u.parse)(n,!0);(0,l.sourceToRegex)(e||"").segments.forEach((e=>a.add(e))),(0,l.sourceToRegex)(t||"").segments.forEach((e=>a.add(e)));for(const e of Object.values(r)){const t=Array.isArray(e)?e[0]:e;(0,l.sourceToRegex)(t||"").segments.forEach((e=>a.add(e)))}}catch(e){}const r=(0,l.collectHasSegments)(s);for(const n of a)if(!o.has(n)&&!r.includes(n))return{message:`${e} at index ${t} has segment ":${n}" in \`destination\` property but not in \`source\` or \`has\` property.`,link:"https://vercel.link/invalid-route-destination-segment"}}return null}function b(e,t){return void 0!==e.permanent&&void 0!==e.statusCode?`Redirect at index ${t} cannot define both \`permanent\` and \`statusCode\` properties.`:null}function R(e,t,r,n){const s=Array.isArray(t)?t:[t];return{name:"RouteApiError",code:e,message:s[0],link:r,action:n,errors:s}}function x(e){return null!=e}function k(e){const{cleanUrls:t,rewrites:r,redirects:n,headers:s,trailingSlash:o}=e;let{routes:a=null}=e;if(a){if(void 0!==t||void 0!==o||void 0!==n||void 0!==s||void 0!==r){return{routes:a,error:R("invalid_mixed_routes","If `rewrites`, `redirects`, `headers`, `cleanUrls` or `trailingSlash` are used, then `routes` cannot be present.","https://vercel.link/mix-routing-props","Learn More")}}return y(a)}if(void 0!==t){const e=y((0,l.convertCleanUrls)(t,o));if(e.error)return e.error.code="invalid_clean_urls",{routes:a,error:e.error};a=a||[],a.push(...e.routes||[])}if(void 0!==o){const e=y((0,l.convertTrailingSlash)(o));if(e.error)return e.error.code="invalid_trailing_slash",{routes:a,error:e.error};a=a||[],a.push(...e.routes||[])}if(void 0!==n){const e="invalid_redirect",t=n.map(((e,t)=>v("Redirect",t,e.source))).find(x);if(t)return{routes:a,error:R("invalid_redirect",t,"https://vercel.link/invalid-route-source-pattern","Learn More")};const r=n.map(((e,t)=>w("Redirect",t,e))).find(x);if(r)return{routes:a,error:R(e,r.message,r.link,"Learn More")};const s=n.map(b).find(x);if(s)return{routes:a,error:R(e,s,"https://vercel.link/redirects-json","Learn More")};const o=y((0,l.convertRedirects)(n));if(o.error)return o.error.code=e,{routes:a,error:o.error};a=a||[],a.push(...o.routes||[])}if(void 0!==s){const e="invalid_header",t=s.map(((e,t)=>v("Header",t,e.source))).find(x);if(t)return{routes:a,error:R(e,t,"https://vercel.link/invalid-route-source-pattern","Learn More")};const r=s.map(((e,t)=>w("Header",t,e))).find(x);if(r)return{routes:a,error:R(e,r.message,r.link,"Learn More")};const n=y((0,l.convertHeaders)(s));if(n.error)return n.error.code=e,{routes:a,error:n.error};a=a||[],a.push(...n.routes||[])}if(void 0!==r){const e="invalid_rewrite",t=r.map(((e,t)=>v("Rewrite",t,e.source))).find(x);if(t)return{routes:a,error:R(e,t,"https://vercel.link/invalid-route-source-pattern","Learn More")};const n=r.map(((e,t)=>w("Rewrite",t,e))).find(x);if(n)return{routes:a,error:R(e,n.message,n.link,"Learn More")};const s=y((0,l.convertRewrites)(r));if(s.error)return s.error.code=e,{routes:a,error:s.error};a=a||[],a.push({handle:"filesystem"}),a.push(...s.routes||[])}return{routes:a,error:null}}}(mr)),mr.exports}Jr(),Ee.posix.join;const Gr="x-astro-middleware-secret",Xr=(e,{middlewareSecret:t,skewProtection:r})=>{const n=new dr(e);return{default:async(e,s)=>{const o=new URL(`https://example.com${e.url}`),a=e.headers["x-forwarded-for"],i=e.headers["x-astro-locals"],c=e.headers[Gr],u=e.headers["x-astro-path"]??o.searchParams.get("x_astro_path");"string"==typeof u&&(e.url=u);let l={};if(i){if(c!==t)return s.statusCode=403,void s.end("Forbidden");l="string"==typeof i?JSON.parse(i):JSON.parse(i[0])}delete e.headers[Gr],r&&"1"===process.env.VERCEL_SKEW_PROTECTION_ENABLED&&(e.headers["x-deployment-id"]=process.env.VERCEL_DEPLOYMENT_ID);const d=await n.render(e,{addCookieHeader:!0,clientAddress:a,locals:l});await dr.writeResponse(d,s)}}};function Yr(){}export{Xr as c,Yr as s};
